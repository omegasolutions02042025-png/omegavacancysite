<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–°–≤–µ—Ä–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ —Ä–µ–∑—é–º–µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/css/modern-style.css">
  <link rel="icon" type="image/png"
        href="{{ url_for('static', path='img/omega-logo.png') }}">
  <style>
    body { background:#f3f4f6; }

    .vacancy-display {
      background: linear-gradient(135deg, #f8f9ff, #e8f2ff);
      border: 2px solid #e1e8ed;
      border-radius: 15px;
      padding: 20px;
      margin: 18px 0 10px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    }
    .vacancy-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 12px;
    }
    .vacancy-title {
      color: #1f2933;
      margin: 0;
      font-size: 1.3em;
      font-weight: 600;
    }
    .vacancy-meta {
      font-size: 0.85rem;
      color: #6b7280;
      display: flex;
      flex-wrap: wrap;
      gap: 8px 14px;
    }
    .vacancy-meta span strong {
      color: #111827;
    }
    .vacancy-content { color: #34495e; line-height: 1.6; }
    .vacancy-text {
      background: white;
      padding: 16px;
      border-radius: 10px;
      border-left: 4px solid #667eea;
      margin-top: 10px;
      white-space: pre-wrap;
      font-family: 'Segoe UI', sans-serif;
      line-height: 1.7;
      max-height: 260px;
      overflow-y: auto;
    }

    .toggle-desc-btn{
      border:none;
      border-radius:999px;
      padding:6px 12px;
      font-size:0.8rem;
      background:#e5e7eb;
      color:#374151;
      cursor:pointer;
    }

    /* —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ */
    #selected-files { margin-top: 8px; font-size: 0.85rem; color: #475569; }
    #selected-files ul { margin: 4px 0 0 0; padding-left: 18px; }

    /* üîÑ –û–≤–µ—Ä–ª–µ–π-–∫—Ä—É—Ç–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .loading-box {
      background: #ffffff;
      border-radius: 16px;
      padding: 20px 28px;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.25);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      max-width: 320px;
      text-align: center;
    }
    .loader-spinner {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: 4px solid #e5e7eb;
      border-top-color: #3b82f6;
      animation: spin 0.7s linear infinite;
    }
    .loading-text-main {
      font-weight: 600;
      color: #111827;
      font-size: 0.98rem;
    }
    .loading-text-sub {
      font-size: 0.85rem;
      color: #6b7280;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .alert-block {
      background:#fee2e2;
      border:1px solid #fecaca;
      color:#b91c1c;
      padding:10px 14px;
      border-radius:10px;
      font-size:0.9rem;
      margin-bottom:10px;
    }
  </style>
</head>
<body>
  {% include "auth/header_auth.html" %}

  <!-- üîÑ –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="loading_overlay" class="loading-overlay">
    <div class="loading-box">
      <div class="loader-spinner"></div>
      <div class="loading-text-main">–ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑—é–º–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–≤–µ—Ä–∫—É‚Ä¶</div>
      <div class="loading-text-sub">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –≤–∫–ª–∞–¥–∫—É.</div>
    </div>
  </div>

  <div class="container">
    <div class="card">
      <h1>üéØ –°–≤–µ—Ä–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ —Ä–µ–∑—é–º–µ</h1>

      {% if not telegram_username %}
        <div class="alert-block">
          –î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–≤–µ—Ä–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Ä–∞–±–æ—á–∏–π Telegram –≤ –ø—Ä–æ—Ñ–∏–ª–µ.
          –°–µ–π—á–∞—Å –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª.
        </div>
        <script>
          setTimeout(function () {
            window.location.href = "/auth/profile";
          }, 5000);
        </script>
      {% endif %}

      <p class="subtitle">
        –í–∞–∫–∞–Ω—Å–∏—è: <strong>{{ vacancy.vacancy_id }}</strong> ‚Äî {{ vacancy.title }}
        <br>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∑—é–º–µ ‚Äî –ò–ò —Å–≤–µ—Ä–∏—Ç –∏—Ö —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏.
        <br>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, DOCX, TXT. –õ–∏–º–∏—Ç ‚Äî 10 –ú–ë –Ω–∞ —Ñ–∞–π–ª.
      </p>

      {% if error %}
        <div class="alert-block">
          {{ error }}
        </div>
      {% endif %}

      <!-- –±–ª–æ–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏ –∏–∑ –ë–î -->
      <div class="vacancy-display" id="vacancy_display">
        <div class="vacancy-header">
          <h3 class="vacancy-title">{{ vacancy.title }}</h3>
          <button type="button" id="toggle_desc_btn" class="toggle-desc-btn">
            –°–∫—Ä—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
          </button>
        </div>
        <div class="vacancy-meta">
          <span><strong>ID:</strong> {{ vacancy.vacancy_id }}</span>
          {% if vacancy.work_format %}
            <span><strong>–§–æ—Ä–º–∞—Ç:</strong> {{ vacancy.work_format }}</span>
          {% endif %}
          {% if vacancy.employment_type %}
            <span><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> {{ vacancy.employment_type }}</span>
          {% endif %}
          {% if vacancy.grade %}
            <span><strong>–ì—Ä–µ–π–¥:</strong> {{ vacancy.grade }}</span>
          {% endif %}
          {% if vacancy.english_level %}
            <span><strong>–ê–Ω–≥–ª–∏–π—Å–∫–∏–π:</strong> {{ vacancy.english_level|upper }}</span>
          {% endif %}
        </div>
        <div class="vacancy-content" id="vacancy_content">
          <div class="vacancy-text">
            {{ vacancy.vacancy_text }}
          </div>
        </div>
      </div>

      {% if telegram_username %}
      <form id="sverka_form" action="/sverka" method="post" enctype="multipart/form-data">
        <!-- —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å ID –≤–∞–∫–∞–Ω—Å–∏–∏ -->
        <input type="hidden" name="vacancy_id" value="{{ vacancy.vacancy_id }}">

        <div class="form-group">
          <label for="resume_file">üìÑ –§–∞–π–ª—ã —Ä–µ–∑—é–º–µ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ):</label>
          <input type="file" id="resume_file" name="resume_file"
                 accept=".pdf,.docx,.txt" multiple required>
          <div id="selected-files" style="display:none;">
            <strong>–í—ã–±—Ä–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:</strong>
            <ul id="selected-files-list"></ul>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="submit" id="submit_btn" class="btn btn-primary" disabled>üöÄ –ù–∞—á–∞—Ç—å —Å–≤–µ—Ä–∫—É</button>
          <p id="form_hint" style="color: #666; font-size: 0.9em; margin-top: 10px; text-align: center;">
            ‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–µ–∑—é–º–µ
          </p>
        </div>
      </form>
      {% else %}
        <!-- –ï—Å–ª–∏ –¢–µ–ª–µ–≥—Ä–∞–º –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω ‚Äî —Ñ–æ—Ä–º—É –≤–æ–æ–±—â–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º -->
        <p style="margin-top:10px;font-size:0.9rem;color:#6b7280;">
          –û–∂–∏–¥–∞–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ Telegram‚Ä¶
        </p>
      {% endif %}

      <script>
        const resumeFile     = document.getElementById('resume_file');
        const submitBtn      = document.getElementById('submit_btn');
        const formHint       = document.getElementById('form_hint');
        const selectedFilesBox  = document.getElementById('selected-files');
        const selectedFilesList = document.getElementById('selected-files-list');
        const formEl         = document.getElementById('sverka_form');
        const loadingOverlay = document.getElementById('loading_overlay');
        const toggleDescBtn  = document.getElementById('toggle_desc_btn');
        const vacancyContent = document.getElementById('vacancy_content');

        function checkFormReady() {
          if (!resumeFile || !submitBtn || !formHint) return;
          const fileSelected = resumeFile.files.length > 0;

          submitBtn.disabled = !fileSelected;

          if (submitBtn.disabled) {
            submitBtn.style.opacity = '0.5';
            submitBtn.style.cursor  = 'not-allowed';
            formHint.textContent    = '‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ä–µ–∑—é–º–µ';
            formHint.style.color    = '#ff6b6b';
          } else {
            submitBtn.style.opacity = '1';
            submitBtn.style.cursor  = 'pointer';
            formHint.textContent    = '‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ! –ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Å–≤–µ—Ä–∫—É';
            formHint.style.color    = '#28a745';
          }
        }

        if (resumeFile) {
          resumeFile.addEventListener('change', function() {
            const files = Array.from(resumeFile.files);
            if (files.length > 0) {
              selectedFilesList.innerHTML = '';
              files.forEach(f => {
                const li = document.createElement('li');
                li.textContent = f.name;
                selectedFilesList.appendChild(li);
              });
              selectedFilesBox.style.display = 'block';
            } else {
              selectedFilesBox.style.display = 'none';
              selectedFilesList.innerHTML = '';
            }
            checkFormReady();
          });
        }

        // —Å–∫—Ä—ã—Ç—å / –ø–æ–∫–∞–∑–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏
        toggleDescBtn.addEventListener('click', () => {
          const hidden = vacancyContent.style.display === 'none';
          vacancyContent.style.display = hidden ? 'block' : 'none';
          toggleDescBtn.textContent = hidden ? '–°–∫—Ä—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ';
        });

        // üîÑ –ü–æ–∫–∞–∑–∞—Ç—å –∫—Ä—É—Ç–∏–ª–∫—É –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã
        if (formEl) {
          formEl.addEventListener('submit', function(e) {
            if (submitBtn.disabled) {
              e.preventDefault();
              return;
            }
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑—é–º–µ...';
            submitBtn.style.opacity = '0.7';
            submitBtn.style.cursor = 'not-allowed';
            loadingOverlay.style.display = 'flex';
          });
        }

        checkFormReady();
      </script>
    </div>
  </div>
</body>
</html>
