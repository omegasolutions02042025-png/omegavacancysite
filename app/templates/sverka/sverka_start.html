{% extends "layouts/base.html" %}

{% block title %}–°–≤–µ—Ä–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ —Ä–µ–∑—é–º–µ ‚Äî Omega Hire{% endblock %}

{% block head %}
<style>
  .page-wrapper {
    max-width: 1000px;
    margin: 0 auto;
    padding: 24px;
  }

  .main-card {
    background: var(--color-bg-surface);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-radius: 16px;
    padding: 40px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 
      0 8px 32px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.1),
      0 0 30px rgba(255, 215, 0, 0.05);
    position: relative;
    overflow: hidden;
  }

  .main-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, 
      transparent 0%, 
      var(--color-accent-gold) 50%, 
      transparent 100%);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
  }

  .page-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-text-heading);
    margin: 0 0 12px;
    text-shadow: 
      0 0 20px rgba(255, 215, 0, 0.3),
      0 2px 4px rgba(0, 0, 0, 0.3);
  }

  .page-subtitle {
    font-size: 1.1rem;
    color: var(--color-text-primary);
    opacity: 0.9;
    margin: 0 0 32px;
  }
  .vacancy-display {
    background: var(--color-bg-surface-2);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 24px;
    margin: 24px 0;
    box-shadow: 
      0 4px 16px rgba(0, 0, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  .vacancy-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    flex-wrap: wrap;
    gap: 12px;
  }

  .vacancy-title {
    color: var(--color-text-heading);
    margin: 0;
    font-size: 1.3em;
    font-weight: 600;
    text-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
  }

  .vacancy-meta {
    font-size: 0.85rem;
    color: var(--color-text-primary);
    opacity: 0.9;
    display: flex;
    flex-wrap: wrap;
    gap: 8px 14px;
  }

  .vacancy-meta span strong {
    color: var(--color-text-heading);
  }

  .vacancy-content { 
    color: var(--color-text-heading); 
    line-height: 1.6; 
  }

  .vacancy-text {
    background: var(--color-bg-surface);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 16px;
    border-radius: 10px;
    border-left: 3px solid var(--color-accent-gold);
    margin-top: 10px;
    white-space: pre-wrap;
    font-family: 'Segoe UI', sans-serif;
    line-height: 1.7;
    max-height: 260px;
    overflow-y: auto;
    box-shadow: 
      0 2px 8px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  .vacancy-text::-webkit-scrollbar {
    width: 6px;
  }

  .vacancy-text::-webkit-scrollbar-track {
    background: transparent;
  }

  .vacancy-text::-webkit-scrollbar-thumb {
    background: var(--color-bg-surface-2);
    border-radius: 3px;
  }

  .vacancy-text::-webkit-scrollbar-thumb:hover {
    background: var(--color-accent-gold);
  }

  .toggle-desc-btn {
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 8px 16px;
    font-size: 0.85rem;
    font-weight: 600;
    background: var(--color-bg-surface);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: var(--color-text-heading);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
      0 2px 8px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  .toggle-desc-btn:hover {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.08) 100%);
    border-color: var(--color-accent-gold);
    color: var(--color-accent-gold);
    transform: translateY(-2px);
    box-shadow: 
      0 4px 12px rgba(0, 0, 0, 0.2),
      0 0 20px rgba(255, 215, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

    /* —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ */
    #selected-files { margin-top: 8px; font-size: 0.85rem; color: #475569; }
    #selected-files ul { margin: 4px 0 0 0; padding-left: 18px; }

  /* üîÑ –û–≤–µ—Ä–ª–µ–π-–∫—Ä—É—Ç–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã */
  .loading-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px) saturate(150%);
    -webkit-backdrop-filter: blur(10px) saturate(150%);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .loading-box {
    background: linear-gradient(135deg, 
      var(--color-bg-surface) 0%, 
      var(--color-bg-surface-2) 100%);
    backdrop-filter: blur(30px) saturate(180%);
    -webkit-backdrop-filter: blur(30px) saturate(180%);
    border-radius: 16px;
    padding: 40px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-top: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 
      0 20px 60px rgba(0, 0, 0, 0.5),
      0 0 60px rgba(255, 215, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    max-width: 360px;
    text-align: center;
    position: relative;
    overflow: hidden;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { 
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }
    to { 
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .loading-box::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, 
      transparent 0%, 
      var(--color-accent-gold) 50%, 
      transparent 100%);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
  }

  .loader-spinner {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 4px solid var(--color-bg-surface-2);
    border-top-color: var(--color-accent-gold);
    animation: spin 0.7s linear infinite;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
  }

  .loading-text-main {
    font-weight: 600;
    color: var(--color-text-heading);
    font-size: 0.98rem;
    text-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
  }

  .loading-text-sub {
    font-size: 0.85rem;
    color: var(--color-text-primary);
    opacity: 0.9;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .form-group {
    margin-bottom: 24px;
  }

  .form-group label {
    display: block;
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text-heading);
    margin-bottom: 12px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
  }

  .form-group input[type="file"] {
    width: 100%;
    padding: 12px;
    border: 2px dashed rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    background: var(--color-bg-surface-2);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: var(--color-text-heading);
    font-size: 0.95rem;
    transition: all 0.3s ease;
    box-shadow: 
      0 2px 8px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  .form-group input[type="file"]:hover {
    border-color: var(--color-accent-gold);
    background: var(--color-bg-surface);
    box-shadow: 
      0 0 0 2px rgba(255, 215, 0, 0.2),
      0 0 20px rgba(255, 215, 0, 0.15),
      0 4px 12px rgba(0, 0, 0, 0.2);
  }

  #selected-files {
    margin-top: 12px;
    padding: 12px 16px;
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.2) 0%, rgba(46, 204, 113, 0.1) 100%);
    border: 1px solid rgba(46, 204, 113, 0.3);
    border-radius: 12px;
    color: #2ECC71;
    font-size: 0.9rem;
    font-weight: 500;
    box-shadow: 
      0 0 15px rgba(46, 204, 113, 0.2),
      0 2px 8px rgba(0, 0, 0, 0.15);
  }

  #selected-files ul {
    margin: 8px 0 0 0;
    padding-left: 20px;
  }

  .form-actions {
    margin-top: 24px;
    text-align: center;
  }

  .btn {
    padding: 14px 32px;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .btn-primary {
    background: var(--gradient-gold);
    color: #0A1929;
    box-shadow: 
      0 4px 15px rgba(255, 215, 0, 0.4),
      0 0 20px rgba(255, 215, 0, 0.2);
    text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  }

  .btn-primary::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    transition: width 0.6s ease, height 0.6s ease;
  }

  .btn-primary:hover::before {
    width: 300px;
    height: 300px;
  }

  .btn-primary:hover:not(:disabled) {
    background: linear-gradient(135deg, #FFE066 0%, var(--color-accent-gold) 100%);
    transform: translateY(-2px);
    box-shadow: 
      0 6px 25px rgba(255, 215, 0, 0.6),
      0 0 40px rgba(255, 215, 0, 0.4);
  }

  .btn-primary:disabled {
    background: var(--color-bg-surface-2);
    color: var(--color-text-muted);
    cursor: not-allowed;
    box-shadow: none;
    opacity: 0.6;
  }

  #form_hint {
    margin-top: 12px;
    font-size: 0.9rem;
    font-weight: 500;
  }

  .alert-block {
    background: linear-gradient(135deg, rgba(231, 76, 60, 0.2) 0%, rgba(231, 76, 60, 0.1) 100%);
    border: 1px solid rgba(231, 76, 60, 0.3);
    color: #E74C3C;
    padding: 16px 20px;
    border-radius: 12px;
    font-size: 0.95rem;
    font-weight: 500;
    margin-bottom: 20px;
    box-shadow: 
      0 0 15px rgba(231, 76, 60, 0.2),
      0 2px 8px rgba(0, 0, 0, 0.15);
  }

  .info-block {
    margin-bottom: 24px;
    padding: 16px;
    background: var(--color-bg-surface-2);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 
      0 2px 8px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  .info-block p {
    margin: 0;
    font-size: 1rem;
    color: var(--color-text-heading);
  }

  .info-block strong {
    color: var(--color-accent-gold);
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
  }
</style>
{% endblock %}

{% block content %}

  <!-- üîÑ –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="loading_overlay" class="loading-overlay">
    <div class="loading-box">
      <div class="loader-spinner"></div>
      <div class="loading-text-main">–ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑—é–º–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–≤–µ—Ä–∫—É‚Ä¶</div>
      <div class="loading-text-sub">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –≤–∫–ª–∞–¥–∫—É.</div>
    </div>
  </div>

  <div class="page-wrapper">
    <header style="text-align: center; margin-bottom: 32px;">
      <h1 class="page-title">üéØ –°–≤–µ—Ä–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ —Ä–µ–∑—é–º–µ</h1>
      <p class="page-subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–µ–∑—é–º–µ ‚Äî –ò–ò —Å–≤–µ—Ä–∏—Ç –∏—Ö —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –≤–∞–∫–∞–Ω—Å–∏–∏</p>
    </header>
    <div class="main-card">

      {% if not telegram_username %}
        <div class="alert-block">
          –î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–≤–µ—Ä–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Ä–∞–±–æ—á–∏–π Telegram –≤ –ø—Ä–æ—Ñ–∏–ª–µ.
          –°–µ–π—á–∞—Å –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª.
        </div>
        <script>
          setTimeout(function () {
            window.location.href = "/auth/profile";
          }, 5000);
        </script>
      {% endif %}

      <div class="info-block">
        <p>
          <strong>–í–∞–∫–∞–Ω—Å–∏—è:</strong> {{ vacancy.vacancy_id }} ‚Äî {{ vacancy.title }}
          <br>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, DOCX, TXT. –õ–∏–º–∏—Ç ‚Äî 10 –ú–ë –Ω–∞ —Ñ–∞–π–ª.
        </p>
      </div>

      {% if error %}
        <div class="alert-block">
          {{ error }}
        </div>
      {% endif %}

      <!-- –±–ª–æ–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏ –∏–∑ –ë–î -->
      <div class="vacancy-display" id="vacancy_display">
        <div class="vacancy-header">
          <h3 class="vacancy-title">{{ vacancy.title }}</h3>
          <button type="button" id="toggle_desc_btn" class="toggle-desc-btn">
            –°–∫—Ä—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
          </button>
        </div>
        <div class="vacancy-meta">
          <span><strong>ID:</strong> {{ vacancy.vacancy_id }}</span>
          {% if vacancy.work_format %}
            <span><strong>–§–æ—Ä–º–∞—Ç:</strong> {{ vacancy.work_format }}</span>
          {% endif %}
          {% if vacancy.employment_type %}
            <span><strong>–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</strong> {{ vacancy.employment_type }}</span>
          {% endif %}
          {% if vacancy.grade %}
            <span><strong>–ì—Ä–µ–π–¥:</strong> {{ vacancy.grade }}</span>
          {% endif %}
          {% if vacancy.english_level %}
            <span><strong>–ê–Ω–≥–ª–∏–π—Å–∫–∏–π:</strong> {{ vacancy.english_level|upper }}</span>
          {% endif %}
        </div>
        <div class="vacancy-content" id="vacancy_content">
          <div class="vacancy-text">
            {{ vacancy.vacancy_text }}
          </div>
        </div>
      </div>

      {% if telegram_username %}
      <form id="sverka_form" action="/sverka" method="post" enctype="multipart/form-data">
        <!-- —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å ID –≤–∞–∫–∞–Ω—Å–∏–∏ -->
        <input type="hidden" name="vacancy_id" value="{{ vacancy.vacancy_id }}">

        <div class="form-group">
          <label for="resume_file">üìÑ –§–∞–π–ª—ã —Ä–µ–∑—é–º–µ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ):</label>
          <input type="file" id="resume_file" name="resume_file"
                 accept=".pdf,.docx,.txt" multiple required>
          <div id="selected-files" style="display:none;">
            <strong>–í—ã–±—Ä–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:</strong>
            <ul id="selected-files-list"></ul>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="submit" id="submit_btn" class="btn btn-primary" disabled>üöÄ –ù–∞—á–∞—Ç—å —Å–≤–µ—Ä–∫—É</button>
          <p id="form_hint" style="color: #666; font-size: 0.9em; margin-top: 10px; text-align: center;">
            ‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–µ–∑—é–º–µ
          </p>
        </div>
      </form>
      {% else %}
        <!-- –ï—Å–ª–∏ –¢–µ–ª–µ–≥—Ä–∞–º –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω ‚Äî —Ñ–æ—Ä–º—É –≤–æ–æ–±—â–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º -->
        <p style="margin-top:10px;font-size:0.9rem;color:var(--color-text-primary);opacity:0.9;">
          –û–∂–∏–¥–∞–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ Telegram‚Ä¶
        </p>
      {% endif %}

      <script>
        const resumeFile     = document.getElementById('resume_file');
        const submitBtn      = document.getElementById('submit_btn');
        const formHint       = document.getElementById('form_hint');
        const selectedFilesBox  = document.getElementById('selected-files');
        const selectedFilesList = document.getElementById('selected-files-list');
        const formEl         = document.getElementById('sverka_form');
        const loadingOverlay = document.getElementById('loading_overlay');
        const toggleDescBtn  = document.getElementById('toggle_desc_btn');
        const vacancyContent = document.getElementById('vacancy_content');

        function checkFormReady() {
          if (!resumeFile || !submitBtn || !formHint) return;
          const fileSelected = resumeFile.files.length > 0;

          submitBtn.disabled = !fileSelected;

          if (submitBtn.disabled) {
            submitBtn.style.opacity = '0.5';
            submitBtn.style.cursor  = 'not-allowed';
            formHint.textContent    = '‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ä–µ–∑—é–º–µ';
            formHint.style.color    = '#E74C3C';
          } else {
            submitBtn.style.opacity = '1';
            submitBtn.style.cursor  = 'pointer';
            formHint.textContent    = '‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ! –ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Å–≤–µ—Ä–∫—É';
            formHint.style.color    = '#2ECC71';
          }
        }

        if (resumeFile) {
          resumeFile.addEventListener('change', function() {
            const files = Array.from(resumeFile.files);
            if (files.length > 0) {
              selectedFilesList.innerHTML = '';
              files.forEach(f => {
                const li = document.createElement('li');
                li.textContent = f.name;
                selectedFilesList.appendChild(li);
              });
              selectedFilesBox.style.display = 'block';
            } else {
              selectedFilesBox.style.display = 'none';
              selectedFilesList.innerHTML = '';
            }
            checkFormReady();
          });
        }

        // —Å–∫—Ä—ã—Ç—å / –ø–æ–∫–∞–∑–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏
        toggleDescBtn.addEventListener('click', () => {
          const hidden = vacancyContent.style.display === 'none';
          vacancyContent.style.display = hidden ? 'block' : 'none';
          toggleDescBtn.textContent = hidden ? '–°–∫—Ä—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ' : '–ü–æ–∫–∞–∑–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ';
        });

        // üîÑ –ü–æ–∫–∞–∑–∞—Ç—å –∫—Ä—É—Ç–∏–ª–∫—É –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã
        if (formEl) {
          formEl.addEventListener('submit', function(e) {
            if (submitBtn.disabled) {
              e.preventDefault();
              return;
            }
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑—é–º–µ...';
            submitBtn.style.opacity = '0.7';
            submitBtn.style.cursor = 'not-allowed';
            loadingOverlay.style.display = 'flex';
          });
        }

        checkFormReady();
      </script>
    </div>
  </div>
{% endblock %}
