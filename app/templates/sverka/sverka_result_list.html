<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–≤–µ—Ä–∫–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/css/modern-style.css">
  <link rel="icon" type="image/png"
        href="{{ url_for('static', path='img/omega-logo.png') }}">
  <style>
    body { background:#f3f4f6; font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; }
    .container { max-width:1100px; margin:30px auto; padding:0 15px; }
    .card { background:#fff; border-radius:16px; padding:24px 24px 28px; box-shadow:0 12px 35px rgba(15,23,42,.08); }
    h1 { margin-top:0; font-size:24px; display:flex; align-items:center; gap:10px; }
    .subtitle { color:#6b7280; margin-top:4px; margin-bottom:20px; }
    .group-title { margin:26px 0 12px; font-size:18px; display:flex; align-items:center; gap:10px; }
    .group-ok { color:#166534; }
    .group-partial { color:#92400e; }
    .group-no { color:#991b1b; }
    .group-unknown { color:#334155; }

    .results-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:16px; }
    .result-item {
      background:linear-gradient(180deg,#fff 0%,#f8fafc 100%);
      border:1px solid #e2e8f0; border-radius:14px; padding:16px 16px 14px;
      display:flex; flex-direction:column; gap:10px; position:relative;
    }
    .result-item h3 { margin:0; font-size:16px; color:#0f172a; display:flex; gap:6px; align-items:center; word-break:break-word; }
    .file-tag { display:inline-flex; gap:4px; align-items:center; background:#eff6ff; color:#1d4ed8; padding:2px 8px; border-radius:9999px; font-size:12px; max-width:100%; word-break:break-word; }
    .status-badge { display:inline-block; padding:3px 8px 3px; border-radius:9999px; font-size:12px; font-weight:600; width:fit-content; }
    .status-ok { background:#dcfce7; color:#166534; }
    .status-missing { background:#fef3c7; color:#92400e; }
    .meta-row { font-size:13px; color:#334155; display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    .meta-chip { display:inline-flex; align-items:center; gap:6px; background:#f1f5f9; color:#0f172a; padding:4px 10px; border-radius:9999px; }
    .result-footer { display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .view-link {
      display:inline-flex; align-items:center; gap:6px; background:rgba(255,255,255,.05);
      border:1px solid rgba(148,163,184,.35); backdrop-filter:blur(6px); color:#0f172a; padding:6px 12px; border-radius:9999px;
      text-decoration:none; font-size:13px; font-weight:500; transition:all .15s ease-out;
    }
    .view-link span[aria-hidden="true"] { font-weight:600; }
    .view-link:hover { background:rgba(226,232,255,.65); border-color:rgba(148,163,184,.7); transform:translateY(-1px); box-shadow:0 5px 14px rgba(15,23,42,.08); }
    .vacancy-pill { background:#e0f2fe; color:#075985; padding:5px 12px; border-radius:9999px; font-size:13px; }
    .empty { background:#f8fafc; border:1px dashed #cbd5f5; border-radius:12px; padding:32px 24px; text-align:center; color:#94a3b8; }
    .navigation a { margin-right:12px; text-decoration:none; color:#0f172a; font-size:14px; }

    @media (max-width:600px){
      .result-footer { flex-direction:column; align-items:flex-start; }
      .view-link { width:100%; justify-content:center; }
    }
  </style>
</head>
<body>
  {% include "auth/header_auth.html" %}
  <div class="container">
    <div class="card">

      <div class="header-row" style="display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:14px;">
        <div>
          <h1>üìÅ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–≤–µ—Ä–∫–∏</h1>
          <p class="subtitle">–í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {{ results|length }} —Ñ–∞–π–ª(–æ–≤).</p>
        </div>
        <div class="vacancy-pill">–í–∞–∫–∞–Ω—Å–∏—è: {{ vacancy_id }}</div>
      </div>

      {% if results and results|length > 0 %}
        {# ---- –ì–†–£–ü–ü–ò–†–û–í–ö–ê –ü–û –í–ï–†–î–ò–ö–¢–£ ---- #}
        {% set ns = namespace(ok=[], partial=[], no=[], unknown=[]) %}
        {% for item in results %}
          {% set idx = loop.index0 %}
          {% set r = item.resume_json if item.resume_json is mapping else {} %}
          {% set verdict = (r.summary.verdict if r and r.summary is defined and r.summary and r.summary.verdict is defined else '') %}
          {% set pair = {'item': item, 'idx': idx} %}
          {% if verdict and '–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥—Ö–æ–¥–∏—Ç' in verdict %}
            {% set _ = ns.ok.append(pair) %}
          {% elif verdict and '–ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç' in verdict %}
            {% set _ = ns.partial.append(pair) %}
          {% elif verdict and '–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç' in verdict %}
            {% set _ = ns.no.append(pair) %}
          {% else %}
            {% set _ = ns.unknown.append(pair) %}
          {% endif %}
        {% endfor %}

        {# ---- –†–ï–ù–î–ï–† –ì–†–£–ü–ü ---- #}
        {% macro render_group(title, cls, pairs) -%}
          {% if pairs|length > 0 %}
            <h2 class="group-title {{ cls }}">{{ title }} ({{ pairs|length }})</h2>
            <div class="results-grid">
              {% for p in pairs %}
                {% set item = p.item %}
                {% set idx = p.idx %}
                {% set fullname = item.candidate_fullname or (item.resume_json.candidate.full_name if item.resume_json is mapping and item.resume_json.candidate is defined and item.resume_json.candidate else '') %}
                {% set have_name = fullname|length > 0 %}

                {# –õ–û–ö–ê–¶–ò–Ø #}
                {% set city = (item.resume_json.candidate.location.city if item.resume_json is mapping and item.resume_json.candidate is defined and item.resume_json.candidate and item.resume_json.candidate.location is defined and item.resume_json.candidate.location and item.resume_json.candidate.location.city is defined else '') %}
                {% set country = (item.resume_json.candidate.location.country if item.resume_json is mapping and item.resume_json.candidate is defined and item.resume_json.candidate and item.resume_json.candidate.location is defined and item.resume_json.candidate.location and item.resume_json.candidate.location.country is defined else '') %}
                {% set location_text = (city ~ (', ' if city and country else '') ~ country) if (city or country) else '–Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å' %}

                {# –ó–ê–†–ü–õ–ê–¢–ù–´–ï –û–ñ–ò–î–ê–ù–ò–Ø #}
                {% set salary_summary = (item.resume_json.summary.salary_expectations if item.resume_json is mapping and item.resume_json.summary is defined and item.resume_json.summary and item.resume_json.summary.salary_expectations is defined else '') %}
                {% set salary_candidate = (item.resume_json.candidate.salary_expectations if item.resume_json is mapping and item.resume_json.candidate is defined and item.resume_json.candidate and item.resume_json.candidate.salary_expectations is defined else '') %}
                {% set salary_text = salary_summary if salary_summary else (salary_candidate if salary_candidate else '–Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å') %}

                <div class="result-item">
                  <h3>{{ have_name and fullname or '–ö–∞–Ω–¥–∏–¥–∞—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω' }}</h3>

                  <div class="file-tag">üìÑ {{ item.filename or "–±–µ–∑_–Ω–∞–∑–≤–∞–Ω–∏—è" }}</div>

                  {% if have_name %}
                    <span class="status-badge status-ok">–§–ò–û –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ</span>
                  {% else %}
                    <span class="status-badge status-missing">–ù—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –§–ò–û</span>
                  {% endif %}

                  <div class="meta-row">
                    <span class="meta-chip">üìç –õ–æ–∫–∞—Ü–∏—è: <strong>{{ location_text }}</strong></span>
                    <span class="meta-chip">üí∞ –û–∂–∏–¥–∞–Ω–∏—è: <strong>{{ salary_text }}</strong></span>
                  </div>

                  <div class="result-footer">
                    <a class="view-link" href="/sverka/result/{{ task_id }}/{{ idx }}?tg_username={{tg_username}}">
                      –û—Ç–∫—Ä—ã—Ç—å —Å–≤–µ—Ä–∫—É <span aria-hidden="true">‚Üí</span>
                    </a>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {%- endmacro %}

        {{ render_group('‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥—Ö–æ–¥–∏—Ç', 'group-ok', ns.ok) }}
        {{ render_group('üü° –ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç (–Ω—É–∂–Ω—ã —É—Ç–æ—á–Ω–µ–Ω–∏—è)', 'group-partial', ns.partial) }}
        {{ render_group('‚õî –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç', 'group-no', ns.no) }}
        {{ render_group('‚ÑπÔ∏è –ë–µ–∑ –≤–µ—Ä–¥–∏–∫—Ç–∞', 'group-unknown', ns.unknown) }}

      {% else %}
        <div class="empty">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.</div>
      {% endif %}

      <div class="navigation" style="margin-top:22px;">
        <a href="/vacancy">üì§ –û—Ç–∫—Ä—ã—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏</a>
        <a href="/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      </div>
    </div>
  </div>
</body>
</html>
