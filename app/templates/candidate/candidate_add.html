<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ ‚Äî OmegaSolutions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/css/modern-style.css">
  <link rel="icon" type="image/png"
        href="{{ url_for('static', path='img/omega-logo.png') }}">

  <style>
    body{
      background:#f3f4f6;
      font-family:system-ui, -apple-system, BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    .create-page{
      max-width:960px;
      margin:32px auto 40px;
      padding:0 16px 40px;
    }

    .create-title{
      text-align:center;
      font-size:2rem;
      font-weight:700;
      color:#111827;
      margin-bottom:10px;
    }
    .create-subtitle{
      text-align:center;
      font-size:1rem;
      color:#6b7280;
      margin-bottom:28px;
    }

    .create-top-row{
      display:flex;
      gap:18px;
      justify-content:center;
      flex-wrap:wrap;
      margin-bottom:28px;
    }
    .create-top-card{
      flex:1 1 260px;
      max-width:320px;
      background:#ffffff;
      border-radius:22px;
      padding:20px 20px 18px;
      box-shadow:0 14px 35px rgba(15,23,42,.10);
      border:1px solid #e5e7eb;
      text-align:center;
    }
    .create-top-icon{
      width:60px;
      height:60px;
      border-radius:18px;
      margin:0 auto 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.6rem;
      background:#eef2ff;
      color:#4f46e5;
    }
    .create-top-title{
      font-size:1rem;
      font-weight:600;
      color:#111827;
      margin-bottom:6px;
    }
    .create-top-text{
      font-size:0.9rem;
      color:#6b7280;
    }

    .create-tabs{
      margin-top:30px;
      background:#ffffff;
      border-radius:22px;
      box-shadow:0 14px 35px rgba(15,23,42,.10);
      border:1px solid #e5e7eb;
      padding:0 0 22px;
    }

    .create-tab-header{
      display:flex;
      border-bottom:1px solid #e5e7eb;
    }
    .create-tab-btn{
      flex:1;
      padding:12px 18px;
      text-align:center;
      font-size:0.95rem;
      font-weight:600;
      cursor:pointer;
      background:#f9fafb;
      color:#4b5563;
      border:none;
      border-bottom:2px solid transparent;
    }
    .create-tab-btn-active{
      background:#ffffff;
      color:#111827;
      border-bottom-color:#111827;
    }

    .create-tab-body{
      padding:26px 26px 18px;
    }

    /* –±–ª–æ–∫ ¬´–∏–∑ —Ñ–∞–π–ª–∞¬ª */

    .upload-dropzone{
      border:2px dashed #d1d5db;
      border-radius:18px;
      background:#f9fafb;
      padding:36px 20px 32px;
      text-align:center;
      cursor:pointer;
      transition:background .15s ease, border-color .15s ease;
    }
    .upload-dropzone:hover{
      background:#f3f4ff;
      border-color:#9ca3af;
    }
    .upload-icon{
      font-size:2.2rem;
      margin-bottom:14px;
      color:#6b7280;
    }
    .upload-title{
      font-size:1rem;
      font-weight:600;
      color:#111827;
      margin-bottom:6px;
    }
    .upload-sub{
      font-size:0.9rem;
      color:#6b7280;
      margin-bottom:6px;
    }
    .upload-hint{
      font-size:0.8rem;
      color:#9ca3af;
    }
    .upload-input{
      display:none;
    }
    .upload-file-name{
      margin-top:10px;
      font-size:0.85rem;
      color:#4b5563;
      text-align:center;
    }

    /* –±–ª–æ–∫ ¬´–∏–∑ —Ç–µ–∫—Å—Ç–∞¬ª */

    .text-label{
      display:block;
      font-size:0.9rem;
      color:#4b5563;
      margin-bottom:6px;
    }
    .text-area{
      width:100%;
      min-height:230px;
      resize:vertical;
      border-radius:14px;
      border:1px solid #d1d5db;
      padding:10px 12px;
      font-size:0.9rem;
      font-family:inherit;
      box-sizing:border-box;
    }
    .text-area:focus{
      outline:none;
      border-color:#4f46e5;
      box-shadow:0 0 0 1px rgba(79,70,229,.35);
    }

    .create-actions{
      margin-top:18px;
      display:flex;
      justify-content:flex-end;
      gap:10px;
      flex-wrap:wrap;
    }
    .btn-secondary{
      padding:9px 16px;
      border-radius:999px;
      border:1px solid #d1d5db;
      background:#ffffff;
      font-size:0.9rem;
      font-weight:500;
      cursor:pointer;
      color:#111827;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    .btn-secondary:hover{
      background:#f9fafb;
    }
    .btn-submit{
      padding:9px 18px;
      border-radius:999px;
      border:none;
      background:#111827;
      color:#f9fafb;
      font-size:0.9rem;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 8px 20px rgba(15,23,42,.45);
    }
    .btn-submit:hover{
      filter:brightness(1.05);
      transform:translateY(-1px);
    }

    @media (max-width:640px){
      .create-tab-body{
        padding-inline:16px;
      }
    }

    /* –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ */

    .loading-overlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:9999;
      font-family:inherit;
    }
    .loading-backdrop{
      position:absolute;
      inset:0;
      background:rgba(15,23,42,.45);
      backdrop-filter:blur(2px);
    }
    .loading-box{
      position:relative;
      z-index:1;
      background:#ffffff;
      border-radius:18px;
      padding:18px 22px 16px;
      box-shadow:0 18px 45px rgba(15,23,42,.35);
      display:flex;
      align-items:center;
      gap:12px;
      min-width:260px;
    }
    .loading-spinner{
      width:28px;
      height:28px;
      border-radius:999px;
      border:3px solid #e5e7eb;
      border-top-color:#111827;
      animation:spin .8s linear infinite;
      flex-shrink:0;
    }
    .loading-text{
      font-size:0.95rem;
      color:#111827;
      font-weight:500;
    }
    @keyframes spin{
      to{
        transform:rotate(360deg);
      }
    }
  </style>
</head>
<body>

  {% include "auth/header_auth.html" %}

  <main class="create-page">
    <h1 class="create-title">–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</h1>
    <p class="create-subtitle">
      –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–µ–∑—é–º–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ ‚Äî –º—ã —Å–æ–∑–¥–∞–¥–∏–º –∫–∞—Ä—Ç–æ—á–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    </p>

    <div class="create-top-row">
      <div class="create-top-card">
        <div class="create-top-icon">üìÑ</div>
        <div class="create-top-title">–ò–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞</div>
        <div class="create-top-text">
          –ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF/DOCX —Ä–µ–∑—é–º–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å.
        </div>
      </div>
      <div class="create-top-card">
        <div class="create-top-icon">‚úèÔ∏è</div>
        <div class="create-top-title">–ò–º–ø–æ—Ä—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞</div>
        <div class="create-top-text">
          –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Ä–µ–∑—é–º–µ ‚Äî –º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª–∏–º –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è.
        </div>
      </div>
    </div>

    <section class="create-tabs">
      <header class="create-tab-header">
        <button type="button"
                id="tab-btn-file"
                class="create-tab-btn create-tab-btn-active"
                onclick="switchTab('file')">
          –ò–∑ —Ñ–∞–π–ª–∞
        </button>
        <button type="button"
                id="tab-btn-text"
                class="create-tab-btn"
                onclick="switchTab('text')">
          –ò–∑ —Ç–µ–∫—Å—Ç–∞
        </button>
      </header>

      <!-- TAB: –ò–ó –§–ê–ô–õ–ê -->
      <div id="tab-file" class="create-tab-body">
        <form action="/candidate/upload" method="post" enctype="multipart/form-data">
          <label class="upload-dropzone" for="candidate-file-input">
            <div class="upload-icon">üìé</div>
            <div class="upload-title">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ä–µ–∑—é–º–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Å—é–¥–∞</div>
            <div class="upload-sub">
              –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ (PDF, DOCX, DOC, RTF)
            </div>
            <div class="upload-hint">
              –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, 10&nbsp;–ú–ë.
            </div>
          </label>

          <input id="candidate-file-input"
                 class="upload-input"
                 type="file"
                 name="files"
                 multiple
                 accept=".pdf,.doc,.docx,.rtf"
                 required>

          <p id="candidate-file-name" class="upload-file-name"></p>

          <div class="create-actions">
            <a href="/candidate" class="btn-secondary">–û—Ç–º–µ–Ω–∞</a>
            <button type="submit" class="btn-submit">–°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</button>
          </div>
        </form>
      </div>

      <!-- TAB: –ò–ó –¢–ï–ö–°–¢–ê -->
      <div id="tab-text" class="create-tab-body" style="display:none;">
        <form action="/candidate/from-text" method="post">
          <label class="text-label" for="candidate-text">
            –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –ø–æ–ª–Ω–æ–µ —Ä–µ–∑—é–º–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ (–Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ)
          </label>
          <textarea id="candidate-text"
                    name="resume_text"
                    class="text-area"
            placeholder="–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ä–µ–∑—é–º–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞‚Ä¶"
            required></textarea>

          <div class="create-actions">
            <a href="/candidate" class="btn-secondary">–û—Ç–º–µ–Ω–∞</a>
            <button type="submit" class="btn-submit">–°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <!-- LOADING OVERLAY -->
  <div id="loading-overlay" class="loading-overlay" style="display:none;">
    <div class="loading-backdrop"></div>
    <div class="loading-box">
      <div class="loading-spinner"></div>
      <div class="loading-text">–°–æ–∑–¥–∞—ë–º –∫–∞–Ω–¥–∏–¥–∞—Ç–∞‚Ä¶</div>
    </div>
  </div>

  <script>
    function switchTab(tab){
      const tabFileBody = document.getElementById("tab-file");
      const tabTextBody = document.getElementById("tab-text");
      const btnFile = document.getElementById("tab-btn-file");
      const btnText = document.getElementById("tab-btn-text");

      if (tab === "file"){
        tabFileBody.style.display = "block";
        tabTextBody.style.display = "none";
        btnFile.classList.add("create-tab-btn-active");
        btnText.classList.remove("create-tab-btn-active");
      }else{
        tabFileBody.style.display = "none";
        tabTextBody.style.display = "block";
        btnFile.classList.remove("create-tab-btn-active");
        btnText.classList.add("create-tab-btn-active");
      }
    }

    function showLoading(){
      const overlay = document.getElementById("loading-overlay");
      if (overlay){
        overlay.style.display = "flex";
      }
    }

    function hideLoading(){
      const overlay = document.getElementById("loading-overlay");
      if (overlay){
        overlay.style.display = "none";
      }
    }

    document.addEventListener("DOMContentLoaded", function(){
      const dz = document.querySelector(".upload-dropzone");
      const input = document.getElementById("candidate-file-input");
      const info = document.getElementById("candidate-file-name");

      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ <label for="..."> –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤,
      // –∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫/–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–µ–∑—é–º–µ.
      if (dz && input){
        input.addEventListener("change", function(){
          if (!info) return;
          if (input.files && input.files.length > 0){
            if (input.files.length === 1){
              info.textContent = "–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: " + input.files[0].name;
            } else {
              const names = Array.from(input.files).map(f => f.name);
              info.textContent = "–í—ã–±—Ä–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: " + input.files.length + " (" + names.join(", ") + ")";
            }
          }else{
            info.textContent = "";
          }
        });
      }

      const forms = document.querySelectorAll(
        'form[action="/candidate/upload"], form[action="/candidate/from-text"]'
      );

      forms.forEach(function(form){
        form.addEventListener("submit", async function(e){
          e.preventDefault();

          if (form.dataset.submitting === "1"){
            return;
          }
          form.dataset.submitting = "1";

          const submitBtn = form.querySelector(".btn-submit");
          if (submitBtn){
            submitBtn.disabled = true;
          }

          showLoading();

          const formData = new FormData(form);

          try{
            const response = await fetch(form.action, {
              method: (form.method || "post").toUpperCase(),
              body: formData,
              headers: { "Accept": "application/json" },
              redirect: "follow"
            });

            if (response.redirected){
              window.location.href = response.url;
              return;
            }

            let data = null;
            const ct = response.headers.get("content-type") || "";
            if (ct.includes("application/json")){
              data = await response.json().catch(() => null);
            }

            if (data && data.candidate_id){
              window.location.href = "/candidate/edit/" + data.candidate_id;
              return;
            }

            hideLoading();
            if (submitBtn){
              submitBtn.disabled = false;
            }
            form.dataset.submitting = "0";
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
          }catch(err){
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:", err);
            hideLoading();
            if (submitBtn){
              submitBtn.disabled = false;
            }
            form.dataset.submitting = "0";
            alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
          }
        });
      });
    });
  </script>

</body>
</html>
