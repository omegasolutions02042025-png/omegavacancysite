{% extends "layouts/base.html" %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ ‚Äî Omega Hire{% endblock %}

{% block head %}
  <style>
  /* Candidate Profile Specific Styles */
  .candidate-profile-page {
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Enhanced Button Glow Effects */
  .candidate-profile-page .btn-primary {
    position: relative;
    overflow: hidden;
    box-shadow: 
      0 4px 15px rgba(255, 215, 0, 0.4),
      0 0 30px rgba(255, 215, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
    text-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  }

  .candidate-profile-page .btn-primary::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    transition: width 0.6s ease, height 0.6s ease;
    pointer-events: none;
  }

  .candidate-profile-page .btn-primary:hover::before {
    width: 300px;
    height: 300px;
  }

  .candidate-profile-page .btn-primary:hover {
    box-shadow: 
      0 6px 25px rgba(255, 215, 0, 0.6),
      0 0 50px rgba(255, 215, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
  }

  .candidate-profile-page .btn-secondary {
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 
      0 2px 10px rgba(0, 0, 0, 0.2),
      0 0 20px rgba(255, 215, 0, 0.1);
  }

  .candidate-profile-page .btn-secondary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(255, 215, 0, 0.2) 50%, 
      transparent 100%);
    transition: left 0.5s ease;
    pointer-events: none;
  }

  .candidate-profile-page .btn-secondary:hover::before {
    left: 100%;
  }

  .candidate-profile-page .btn-secondary:hover {
    box-shadow: 
      0 4px 15px rgba(0, 0, 0, 0.3),
      0 0 30px rgba(255, 215, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  /* Page Header Glow */
  .candidate-profile-page h1,
  .candidate-profile-page .h2 {
    text-shadow: 
      0 0 20px rgba(255, 215, 0, 0.3),
      0 0 40px rgba(255, 215, 0, 0.1),
      0 2px 4px rgba(0, 0, 0, 0.3);
    position: relative;
  }

  .candidate-profile-page h1::after,
  .candidate-profile-page .h2::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 0;
    width: 100px;
    height: 3px;
    background: linear-gradient(90deg, 
      var(--color-accent-gold) 0%, 
      transparent 100%);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
    border-radius: 2px;
  }

  /* Layout: Sidebar Navigation + Content */
  .profile-layout {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: 32px;
    align-items: start;
  }

  @media (max-width: 1024px) {
    .profile-layout {
      grid-template-columns: 1fr;
    }
    
    .profile-menu {
      position: static;
      order: -1;
    }
    
    .profile-steps {
      flex-direction: row;
      flex-wrap: wrap;
      overflow-x: auto;
    }
  }

  /* Sidebar Navigation */
  .profile-menu {
    position: sticky;
    top: 90px; /* Header height + gap */
    align-self: start;
  }

  .profile-steps {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 16px;
    background: var(--color-bg-surface-2);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 
      0 8px 32px rgba(0, 0, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.1),
      0 0 20px rgba(255, 215, 0, 0.05);
  }

  .profile-step {
    display: block;
    padding: 10px 16px;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text-primary);
    text-decoration: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-left: 3px solid transparent;
    position: relative;
    overflow: hidden;
  }

  .profile-step::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.05) 0%, rgba(255, 215, 0, 0.02) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .profile-step:hover {
    color: var(--color-text-heading);
    background: rgba(255, 255, 255, 0.05);
    border-left-color: rgba(255, 215, 0, 0.3);
    box-shadow: 
      0 4px 12px rgba(0, 0, 0, 0.2),
      0 0 15px rgba(255, 215, 0, 0.1);
    transform: translateX(2px);
  }

  .profile-step:hover::before {
    opacity: 1;
  }

  .profile-step.active {
    color: var(--color-accent-gold);
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.08) 100%);
    border-left-color: var(--color-accent-gold);
    box-shadow: 
      0 4px 16px rgba(255, 215, 0, 0.2),
      0 0 20px rgba(255, 215, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  .profile-step.active::before {
    opacity: 1;
  }

  /* Content Sections */
  .profile-content {
    min-width: 0;
  }

  .profile-grid {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  /* Section Cards */
  .section-card {
    background: var(--color-bg-surface);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-radius: 16px;
    padding: 32px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
      0 8px 32px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.1),
      0 0 30px rgba(255, 215, 0, 0.05);
    position: relative;
    overflow: hidden;
  }

  .section-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(255, 215, 0, 0.3) 50%, 
      transparent 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .section-card:hover {
    border-color: rgba(255, 215, 0, 0.3);
    box-shadow: 
      0 12px 40px rgba(0, 0, 0, 0.5),
      inset 0 1px 0 rgba(255, 255, 255, 0.15),
      0 0 40px rgba(255, 215, 0, 0.15),
      0 0 60px rgba(255, 215, 0, 0.05);
    transform: translateY(-2px);
  }

  .section-card:hover::before {
    opacity: 1;
  }

  .section-card.card-error {
    border-color: rgba(231, 76, 60, 0.5);
    box-shadow: 
      0 0 0 1px rgba(231, 76, 60, 0.2),
      0 0 20px rgba(231, 76, 60, 0.15);
  }

  .section-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--color-text-heading);
    margin: 0 0 8px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
    position: relative;
    display: inline-block;
  }

  .section-title::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 60px;
    height: 2px;
    background: linear-gradient(90deg, var(--color-accent-gold), transparent);
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  .section-subtitle {
    font-size: 0.875rem;
    color: var(--color-text-primary);
    margin: 0 0 24px;
    opacity: 0.9;
  }

  /* Form Fields */
  .field-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
    margin-bottom: 20px;
  }

  .field {
    min-width: 0;
  }

  .field label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  .field input,
  .field select,
  .field textarea,
  .salary-widget input,
  .salary-widget select,
  .form-input,
  .form-select {
    width: 100%;
    background: var(--color-bg-surface-2);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    padding: 12px 16px;
    color: var(--color-text-heading);
    font-size: 0.95rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
      0 2px 8px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
    cursor: text;
  }

  .form-select {
    cursor: pointer;
  }

  .field input:focus,
  .field select:focus,
  .field textarea:focus,
  .salary-widget input:focus,
  .salary-widget select:focus,
  .form-input:focus,
  .form-select:focus {
    outline: none;
    border-color: var(--color-accent-gold);
    background: var(--color-bg-surface);
    box-shadow: 
      0 0 0 2px rgba(255, 215, 0, 0.2),
      0 0 20px rgba(255, 215, 0, 0.15),
      0 4px 12px rgba(0, 0, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transform: translateY(-1px);
  }

  .form-input:disabled,
  .form-select:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .field textarea {
    min-height: 120px;
    resize: vertical;
    font-family: inherit;
  }

  .field-error label {
    color: #E74C3C;
  }

    .field-error input,
    .field-error textarea,
  .field-error select {
    border-color: #E74C3C !important;
    box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.1) !important;
  }

  /* Chips (Buttons) */
  .chips-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 8px;
  }

  .chip {
    padding: 8px 16px;
    border-radius: 99px;
    background: var(--color-bg-surface-2);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: var(--color-text-primary);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    user-select: none;
    box-shadow: 
      0 2px 8px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
    position: relative;
    overflow: hidden;
  }

  .chip::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    transition: width 0.4s ease, height 0.4s ease;
    pointer-events: none;
  }

  .chip:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 215, 0, 0.4);
    box-shadow: 
      0 4px 12px rgba(0, 0, 0, 0.3),
      0 0 15px rgba(255, 215, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transform: translateY(-2px) scale(1.02);
  }

  .chip:hover::before {
    width: 120px;
    height: 120px;
  }

  .chip.chip-selected {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 215, 0, 0.1) 100%);
    border-color: var(--color-accent-gold);
    color: var(--color-accent-gold);
    box-shadow: 
      0 0 20px rgba(255, 215, 0, 0.4),
      0 0 40px rgba(255, 215, 0, 0.2),
      0 4px 12px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
    transform: scale(1.05);
  }

  .chip.chip-selected::before {
    width: 150px;
    height: 150px;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.3) 0%, transparent 70%);
  }

  .chips-error .chip {
    border-color: #E74C3C !important;
    box-shadow: 0 0 0 1px rgba(231, 76, 60, 0.2) !important;
  }

  /* Dynamic Item Blocks (Experience, Education, etc.) */
  .item-block {
    background: var(--color-bg-surface-2);
    backdrop-filter: blur(15px) saturate(150%);
    -webkit-backdrop-filter: blur(15px) saturate(150%);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
      0 4px 16px rgba(0, 0, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.08);
    position: relative;
    overflow: hidden;
  }

  .item-block::before {
    content: '';
    position: absolute;
      top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(255, 215, 0, 0.1) 50%, 
      transparent 100%);
    transition: left 0.5s ease;
  }

  .item-block:hover {
    border-color: rgba(255, 215, 0, 0.4);
    background: var(--color-bg-surface);
    box-shadow: 
      0 8px 24px rgba(0, 0, 0, 0.3),
      0 0 30px rgba(255, 215, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
  }

  .item-block:hover::before {
    left: 100%;
  }

  .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
  }

  .item-header::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 50px;
    height: 2px;
    background: linear-gradient(90deg, 
      rgba(255, 215, 0, 0.5) 0%, 
      transparent 100%);
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
  }

  .item-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text-heading);
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
  }

  .item-index {
    font-size: 0.75rem;
    color: var(--color-text-primary);
    opacity: 0.8;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* Photo Upload */
  .photo-upload {
    display: flex;
    align-items: center;
    gap: 20px;
      margin-bottom: 24px;
    }

  .photo-preview {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: var(--color-bg-surface-2);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.2);
      display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    flex-shrink: 0;
    box-shadow: 
      0 4px 16px rgba(0, 0, 0, 0.2),
      0 0 20px rgba(255, 215, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
  }

  .photo-preview:hover {
    border-color: rgba(255, 215, 0, 0.5);
    box-shadow: 
      0 6px 24px rgba(0, 0, 0, 0.4),
      0 0 30px rgba(255, 215, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
    transform: scale(1.05);
  }

  .photo-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none;
  }

  .photo-preview.has-photo img {
      display: block;
  }

  .photo-placeholder {
    font-size: 2.5rem;
    color: var(--color-text-primary);
    opacity: 0.7;
  }

  /* Salary Widget */
    .salary-widget {
    background: linear-gradient(135deg, 
      var(--color-bg-surface) 0%, 
      var(--color-bg-surface-2) 100%);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 16px;
      padding: 24px;
    margin: 24px 0;
    box-shadow: 
      0 8px 32px rgba(0, 0, 0, 0.3),
      0 0 40px rgba(255, 215, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
  }

  .salary-widget::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
    animation: pulse 4s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
  }

  .salary-widget-header,
  .salary-input-group,
  .converted-rates,
  .salary-widget-footer {
    position: relative;
    z-index: 1;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.1); }
  }

    .salary-widget:hover {
    border-color: rgba(255, 215, 0, 0.5);
    box-shadow: 
      0 12px 40px rgba(0, 0, 0, 0.5),
      0 0 60px rgba(255, 215, 0, 0.25),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
  }

    .salary-widget-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    margin-bottom: 20px;
    }

    .salary-widget-label {
      font-size: 1rem;
      font-weight: 600;
    color: var(--color-text-heading);
      margin: 0;
    }

    .salary-input-group {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      align-items: stretch;
    }

  .currency-select {
      flex-shrink: 0;
      width: auto;
      min-width: 120px;
      max-width: 150px;
  }

    .salary-input {
      flex: 1;
      min-width: 200px;
      width: 100%;
      display: block;
      visibility: visible;
      opacity: 1;
  }

    .converted-rates {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
      padding: 16px;
    background: var(--color-bg-surface);
      border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .converted-rate-item {
    text-align: center;
      padding: 12px;
    background: var(--color-bg-surface-2);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
      border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    box-shadow: 
      0 2px 8px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

    .converted-rate-item:hover {
    background: var(--color-bg-surface);
    border-color: rgba(255, 215, 0, 0.3);
    box-shadow: 
      0 4px 12px rgba(0, 0, 0, 0.2),
      0 0 20px rgba(255, 215, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
  }

    .rate-currency {
    font-size: 0.8rem;
    color: var(--color-text-primary);
    opacity: 0.85;
    margin-bottom: 4px;
  }

    .rate-value {
    font-size: 1.25rem;
      font-weight: 700;
    color: var(--color-accent-gold);
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .rate-value.loading {
    color: var(--color-text-primary);
    opacity: 0.7;
      font-style: italic;
    }

    .salary-widget-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
  }

  .rate-status {
    font-size: 0.875rem;
    color: var(--color-text-primary);
    opacity: 0.85;
  }

  .rate-status.success {
    color: #2ECC71;
  }

  .rate-status.error {
    color: #E74C3C;
  }

  /* Modal */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px) saturate(150%);
    -webkit-backdrop-filter: blur(10px) saturate(150%);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
  }

  .modal-overlay.visible {
    display: flex;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .modal-content {
    background: linear-gradient(135deg, 
      var(--color-bg-surface) 0%, 
      var(--color-bg-surface-2) 100%);
    backdrop-filter: blur(30px) saturate(180%);
    -webkit-backdrop-filter: blur(30px) saturate(180%);
    border-radius: 16px;
    padding: 32px;
    max-width: 500px;
    width: 100%;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-top: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 
      0 20px 60px rgba(0, 0, 0, 0.5),
      0 0 60px rgba(255, 215, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
    animation: slideUp 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .modal-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, 
      transparent 0%, 
      var(--color-accent-gold) 50%, 
      transparent 100%);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
  }

  @keyframes slideUp {
    from { 
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }
    to { 
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-heading);
    margin: 0;
    text-shadow: 
      0 0 15px rgba(255, 215, 0, 0.3),
      0 2px 4px rgba(0, 0, 0, 0.3);
    position: relative;
  }

  .modal-title::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 0;
    width: 80px;
    height: 2px;
    background: linear-gradient(90deg, 
      var(--color-accent-gold) 0%, 
      transparent 100%);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
  }

  .modal-close {
    background: transparent;
      border: none;
    font-size: 1.5rem;
    color: var(--color-text-muted);
      cursor: pointer;
    width: 32px;
    height: 32px;
      display: flex;
      align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.3s ease;
    position: relative;
  }

  .modal-close::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    transition: width 0.3s ease, height 0.3s ease;
  }

  .modal-close:hover {
    background: rgba(255, 255, 255, 0.08);
    color: var(--color-accent-gold);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
  }

  .modal-close:hover::before {
    width: 40px;
    height: 40px;
  }

  .file-status {
    margin-top: 12px;
    font-size: 0.875rem;
  }

  .file-status.success {
    color: #2ECC71;
  }

  .file-status.error {
    color: #E74C3C;
  }

  /* Save Notice Toast */
  .save-notice {
    position: fixed;
    right: 32px;
    bottom: 32px;
    padding: 16px 24px;
    background: linear-gradient(135deg, #2ECC71 0%, #27AE60 100%);
    color: white;
    border-radius: 12px;
    font-weight: 600;
    box-shadow: 
      0 10px 30px rgba(46, 204, 113, 0.5),
      0 0 40px rgba(46, 204, 113, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
    opacity: 0;
    transform: translateY(20px) scale(0.9);
    pointer-events: none;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 100;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
  }

  .save-notice.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
    animation: toastPulse 0.3s ease;
  }

  @keyframes toastPulse {
    0% { transform: translateY(20px) scale(0.9); }
    50% { transform: translateY(-5px) scale(1.05); }
    100% { transform: translateY(0) scale(1); }
  }

  /* Section Footer */
  .section-footer {
    display: flex;
    justify-content: flex-end;
    margin-top: 32px;
    padding-top: 24px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
  }

  .section-footer::before {
    content: '';
    position: absolute;
    top: -1px;
    left: 0;
    width: 100px;
    height: 2px;
    background: linear-gradient(90deg, 
      rgba(255, 215, 0, 0.5) 0%, 
      transparent 100%);
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
    }
  </style>
{% endblock %}

{% block content %}
<div class="candidate-profile-page" data-candidate-id="{{ candidate_id }}">
  <!-- Save Notice Toast -->
  <div id="save-notice" class="save-notice">–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω</div>

  <!-- Update Resume Modal -->
  <div id="update-resume-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">–û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—é–º–µ</h2>
        <button type="button" class="modal-close" id="close-modal-btn">√ó</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 16px; color: var(--color-text-primary); font-size: 0.9rem;">
          –ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Ä–µ–∑—é–º–µ. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ —Ä–µ–∑—é–º–µ –±—É–¥–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∞ —Å –Ω–æ–≤–æ–π.
        </p>
        <div>
          <label class="field label" style="display: block; margin-bottom: 8px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Ä–µ–∑—é–º–µ</label>
          <input type="file" id="resume-file-input" class="form-input" accept=".pdf,.docx,.txt,.rtf">
          <div id="file-status" class="file-status"></div>
        </div>
      </div>
      <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
        <button type="button" class="btn btn-secondary" id="cancel-update-btn">–û—Ç–º–µ–Ω–∞</button>
        <button type="button" class="btn btn-primary" id="submit-update-btn" disabled>–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- Page Header -->
  <div class="d-flex align-items-center justify-content-between mb-4">
    <h1 class="h2 mb-0 text-white">–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</h1>
      {% if candidate_id %}
    <button type="button" id="update-resume-btn" class="btn btn-primary">
      <i class="bi bi-file-earmark-arrow-up me-2"></i>–û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—é–º–µ
    </button>
      {% endif %}
  </div>

    <div class="profile-layout">
    <!-- Sidebar Navigation -->
      <aside class="profile-menu">
        <nav class="profile-steps">
        <a href="#personal" class="profile-step active">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</a>
        <a href="#main" class="profile-step">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</a>
        <a href="#location" class="profile-step">–õ–æ–∫–∞—Ü–∏—è –∏ —Ç–∞–π–º–∑–æ–Ω–∞</a>
          <a href="#experience" class="profile-step">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</a>
        <a href="#education" class="profile-step">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</a>
        <a href="#courses" class="profile-step">–ö—É—Ä—Å—ã –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</a>
        <a href="#projects" class="profile-step">–ü—Ä–æ–µ–∫—Ç—ã</a>
        <a href="#english" class="profile-step">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫</a>
        </nav>
      </aside>

    <!-- Main Content -->
      <div class="profile-content">
        <form id="candidate-form">
          <div class="profile-grid">

          <!-- Personal Information -->
          <section id="personal" class="section-card">
            <h2 class="section-title">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <p class="section-subtitle">–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</p>

            <!-- Photo Upload -->
            <div class="photo-upload">
              <div id="photo-preview" class="photo-preview">
                <img id="photo-img" src="" alt="" style="display: none;">
                <span id="photo-placeholder" class="photo-placeholder">üë§</span>
                    </div>
                    <div style="flex: 1;">
                      <input type="file" id="photo-input" accept="image/*" style="display: none;">
                <button type="button" onclick="document.getElementById('photo-input').click()" class="btn btn-secondary">
                  <i class="bi bi-camera me-2"></i>–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ
                      </button>
                <div id="photo-status" style="font-size: 0.8rem; color: var(--color-text-primary); opacity: 0.85; margin-top: 8px;"></div>
                </div>
              </div>

              <div class="field-row">
                <div class="field">
                  <label>–§–∞–º–∏–ª–∏—è</label>
                  <input type="text" name="last_name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–µ–º—Ü–æ–≤">
                </div>
                <div class="field">
                  <label>–ò–º—è</label>
                  <input type="text" name="first_name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≥–æ—Ä—å">
                </div>
                <div class="field">
                  <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                  <input type="text" name="middle_name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–µ—Ä–≥–µ–µ–≤–∏—á">
                </div>
              </div>

              <div class="field-row">
                <div class="field">
                  <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                  <input type="text" name="title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Tech Lead Java/GO Backend">
                </div>
              </div>

              <div class="field-row">
                <div class="field">
                  <label>Email</label>
                  <input type="email" name="email" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: name@company.com">
                </div>
                <div class="field">
                  <label>Telegram (@username)</label>
                  <input type="text" name="telegram" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: @username">
                </div>
                <div class="field">
                <label>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                  <input type="text" name="phone" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: +375291234567">
                </div>
              </div>

              <div class="field-row">
                <div class="field">
                  <label>LinkedIn</label>
                <input type="url" name="linkedin" placeholder="https://linkedin.com/in/...">
                </div>
                <div class="field">
                  <label>GitHub</label>
                <input type="url" name="github" placeholder="https://github.com/...">
                </div>
                <div class="field">
                  <label>–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ / —Å–∞–π—Ç</label>
                <input type="url" name="portfolio" placeholder="https://my-portfolio.com">
                </div>
              </div>

            <div class="field-row">
                <div class="field">
                  <label>–û —Å–µ–±–µ</label>
                <textarea name="about" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–ø—ã—Ç–∞, —Å–∏–ª—å–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω –∏ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏—Ö –∑–∞–¥–∞—á..."></textarea>
                </div>
              </div>
            </section>

          <!-- Main Information -->
          <section id="main" class="section-card">
            <h2 class="section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <p class="section-subtitle">–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –≥—Ä–µ–π–¥, —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</p>

            <!-- Salary Widget -->
              <div id="salary-widget" class="salary-widget">
                <div class="salary-widget-header">
                <h3 class="salary-widget-label">üí∞ –°—Ç–∞–≤–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</h3>
                <select id="rate-type-select" class="form-select" style="width: auto; min-width: 160px;">
                      <option value="hourly">üíº –ü–æ—á–∞—Å–æ–≤–∞—è</option>
                      <option value="monthly" selected>üìÜ –ú–µ—Å—è—á–Ω–∞—è</option>
                      <option value="yearly">üìÖ –ì–æ–¥–æ–≤–∞—è</option>
                    </select>
                </div>
                
                <div class="salary-input-group">
                  <input 
                    type="number" 
                    id="base-amount-input" 
                    class="form-input salary-input" 
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É"
                    step="0.01"
                    min="0"
                    style="position: relative; z-index: 10;"
                  >
                <select id="base-currency-select" class="form-select currency-select" style="position: relative; z-index: 10;">
                      <option value="RUB">‚ÇΩ RUB</option>
                      <option value="USD" selected>$ USD</option>
                      <option value="EUR">‚Ç¨ EUR</option>
                      <option value="BYN">Br BYN</option>
                    </select>
                </div>
                
                <div id="converted-rates" class="converted-rates">
                  <div class="converted-rate-item">
                  <div class="rate-currency">‚ÇΩ RUB</div>
                  <div class="rate-value" id="rate-rub">‚Äî</div>
                  </div>
                  <div class="converted-rate-item">
                  <div class="rate-currency">$ USD</div>
                  <div class="rate-value" id="rate-usd">‚Äî</div>
                  </div>
                  <div class="converted-rate-item">
                  <div class="rate-currency">‚Ç¨ EUR</div>
                  <div class="rate-value" id="rate-eur">‚Äî</div>
                  </div>
                  <div class="converted-rate-item">
                  <div class="rate-currency">Br BYN</div>
                  <div class="rate-value" id="rate-byn">‚Äî</div>
                  </div>
                </div>
                
                <div class="salary-widget-footer">
                <button type="button" id="save-rate-btn" class="btn btn-primary" disabled>
                  <i class="bi bi-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞–≤–∫—É
                  </button>
                  <span id="rate-status" class="rate-status"></span>
                </div>
              </div>
              
              <input type="hidden" name="salary_usd" id="salary_usd_hidden">
              <input type="hidden" name="currencies" value="RUB, USD, EUR, BYN">

              <div class="field-row">
                <div class="field">
                  <label>–ì—Ä–µ–π–¥</label>
                  <div class="chips-row" data-group="grade">
                    <button type="button" class="chip" data-value="Junior">Junior</button>
                    <button type="button" class="chip" data-value="Junior+">Junior+</button>
                    <button type="button" class="chip" data-value="Middle">Middle</button>
                    <button type="button" class="chip" data-value="Middle+">Middle+</button>
                    <button type="button" class="chip" data-value="Senior">Senior</button>
                    <button type="button" class="chip" data-value="Senior+">Senior+</button>
                    <button type="button" class="chip" data-value="Lead">Lead</button>
                  </div>
                  <input type="hidden" name="grade">
                </div>
              </div>

              <div class="field-row">
                <div class="field">
                  <label>–§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã</label>
                  <div class="chips-row" data-group="work_format">
                    <button type="button" class="chip" data-value="office">office</button>
                    <button type="button" class="chip" data-value="remote">remote</button>
                    <button type="button" class="chip" data-value="hybrid">hybrid</button>
                  </div>
                  <input type="hidden" name="work_format">
                </div>
                <div class="field">
                  <label>–¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏</label>
                  <div class="chips-row" data-group="employment_type">
                    <button type="button" class="chip" data-value="full-time">full-time</button>
                    <button type="button" class="chip" data-value="part-time">part-time</button>
                    <button type="button" class="chip" data-value="project">project</button>
                    <button type="button" class="chip" data-value="internship">internship</button>
                  </div>
                  <input type="hidden" name="employment_type">
                </div>
              </div>

              <div class="field-row">
                <div class="field">
                  <label>–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ —Ç–∏–ø—ã –∫–æ–º–ø–∞–Ω–∏–π</label>
                  <input type="text" name="company_types" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ç–∞—Ä—Ç–∞–ø, –ü—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è">
                </div>
              </div>

              <div class="field-row">
                <div class="field">
                  <label>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</label>
                  <input type="text" name="specializations" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Backend_dev, Data Engineer">
                </div>
              </div>

            <div class="field-row">
                <div class="field">
                  <label>–ù–∞–≤—ã–∫–∏</label>
                  <textarea name="skills" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Java, Go, Spring Boot, Kafka, PostgreSQL"></textarea>
                </div>
              </div>
            </section>

          <!-- Location -->
          <section id="location" class="section-card">
            <h2 class="section-title">–õ–æ–∫–∞—Ü–∏—è –∏ —Ç–∞–π–º–∑–æ–Ω–∞</h2>

              <div class="field-row">
                <div class="field">
                  <label>–ì–æ—Ä–æ–¥</label>
                  <input type="text" name="city" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Varna">
                </div>
                <div class="field">
                  <label>–°—Ç—Ä–∞–Ω–∞</label>
                  <input type="text" name="countries" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Bulgaria">
                </div>
              </div>

              <div class="field-row">
                <div class="field">
                  <label>–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å</label>
                  <input type="text" name="timezone" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: GMT+3 –∏–ª–∏ Europe/Sofia">
                </div>
                <div class="field">
                  <label>–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ —Ä–µ–≥–∏–æ–Ω—ã</label>
                  <input type="text" name="regions" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ï–≤—Ä–æ–ø–∞, –°–®–ê, MENA">
                </div>
              </div>

              <div class="field-row">
                <div class="field">
                  <label>–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ —Å—Ç—Ä–∞–Ω—ã</label>
                  <input type="text" name="preferred_countries" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì–µ—Ä–º–∞–Ω–∏—è, –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã, –ö–∞–Ω–∞–¥–∞">
                </div>
              </div>

            <div class="field-row">
                <div class="field">
                  <label>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–ª–æ–∫–∞—Ü–∏–∏</label>
                  <input type="text" name="relocation" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì–æ—Ç–æ–≤ –∫ —Ä–µ–ª–æ–∫–∞—Ü–∏–∏ –≤ –ï–°">
                </div>
              </div>
            </section>

          <!-- Experience -->
          <section id="experience" class="section-card">
            <h2 class="section-title">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</h2>
            <p class="section-subtitle">–í—Å–µ –º–µ—Å—Ç–∞ —Ä–∞–±–æ—Ç—ã –∏–∑ —Ä–µ–∑—é–º–µ (–æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏–º)</p>
              <div id="experience-list"></div>
            </section>

          <!-- Education -->
          <section id="education" class="section-card">
            <h2 class="section-title">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</h2>
            <p class="section-subtitle">–í—Å–µ —É—á–µ–±–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è –∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–±—É—á–µ–Ω–∏—è</p>
              <div id="education-list"></div>
            </section>

          <!-- Courses -->
          <section id="courses" class="section-card">
            <h2 class="section-title">–ö—É—Ä—Å—ã –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h2>
            <p class="section-subtitle">–û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ</p>
              <div id="courses-list"></div>
            </section>

          <!-- Projects -->
          <section id="projects" class="section-card">
            <h2 class="section-title">–ü—Ä–æ–µ–∫—Ç—ã</h2>
            <p class="section-subtitle">–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</p>
              <div id="projects-list"></div>
            </section>

          <!-- English -->
          <section id="english" class="section-card">
            <h2 class="section-title">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫</h2>

            <div class="field-row">
                <div class="field">
                  <label>–£—Ä–æ–≤–µ–Ω—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ</label>
                  <div class="chips-row" data-group="english_level">
                    <button type="button" class="chip" data-value="A1">A1</button>
                    <button type="button" class="chip" data-value="A2">A2</button>
                    <button type="button" class="chip" data-value="B1">B1</button>
                    <button type="button" class="chip" data-value="B2">B2</button>
                    <button type="button" class="chip" data-value="C1">C1</button>
                    <button type="button" class="chip" data-value="C2">C2</button>
                  </div>
                  <input type="hidden" name="english_level">
                </div>
              </div>

              <div class="section-footer">
              <button type="button" id="save-btn" class="btn btn-primary">
                <i class="bi bi-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
              </button>
              </div>
            </section>

          </div>
        </form>
      </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
  const candidateId = document.querySelector('.candidate-profile-page')?.dataset.candidateId;
      const menuLinks = Array.from(document.querySelectorAll(".profile-step"));
  const sections = Array.from(document.querySelectorAll("section[id]"));
  const chips = Array.from(document.querySelectorAll(".chip"));
      const saveNotice = document.getElementById("save-notice");

      const REQUIRED_FIELDS = [
    "last_name", "first_name", "middle_name", "email", "telegram", "phone",
    "currencies", "grade", "work_format", "employment_type", "specializations",
    "skills", "countries", "english_level"
  ];

  // ===== Helpers =====
      const setValue = (name, value) => {
        if (value === null || value === undefined) return;
        const el = document.querySelector('[name="' + name + '"]');
        if (el) el.value = value;
      };

      const getValue = (name) => {
        const el = document.querySelector('[name="' + name + '"]');
        return el ? el.value.trim() : "";
      };

      const setChipGroup = (group, value) => {
        const groupRow = document.querySelector('.chips-row[data-group="' + group + '"]');
        if (!groupRow) return;
        const groupChips = groupRow.querySelectorAll(".chip");
        groupChips.forEach(chip => {
          chip.classList.toggle("chip-selected", chip.dataset.value === value);
        });
        const hidden = document.querySelector('input[name="' + group + '"]');
        if (hidden) hidden.value = value || "";
      };

      const setMultiChipGroup = (group, csv) => {
        const values = (csv || "").split(",").map(v => v.trim()).filter(Boolean);
        const groupRow = document.querySelector('.chips-row[data-group="' + group + '"]');
        if (!groupRow) return;
        const groupChips = groupRow.querySelectorAll(".chip");
        groupChips.forEach(chip => {
          chip.classList.toggle("chip-selected", values.includes(chip.dataset.value));
        });
        const hidden = document.querySelector('input[name="' + group + '"]');
        if (hidden) hidden.value = values.join(", ");
      };

      const clearErrors = () => {
        document.querySelectorAll(".field-error").forEach(f => f.classList.remove("field-error"));
        document.querySelectorAll(".chips-error").forEach(r => r.classList.remove("chips-error"));
        document.querySelectorAll(".card-error").forEach(c => c.classList.remove("card-error"));
      };

      const markFieldError = (name) => {
        const el = document.querySelector('[name="' + name + '"]');
        if (el) {
          const field = el.closest(".field");
          if (field) {
            field.classList.add("field-error");
            const chipsRow = field.querySelector(".chips-row");
        if (chipsRow) chipsRow.classList.add("chips-error");
          }
        }
      };

      function highlightRequiredFields() {
        REQUIRED_FIELDS.forEach((name) => {
          const el = document.querySelector('[name="' + name + '"]');
          if (!el) return;
          const field = el.closest(".field");
          if (!field) return;
          const value = (el.value || "").trim();
      field.classList.toggle("field-error", !value);
    });

        const expCard = document.getElementById("experience");
        if (expCard) {
          const expItems = expCard.querySelectorAll(".exp-item");
          let hasAnyExpData = false;
          expItems.forEach(item => {
            const values = Array.from(item.querySelectorAll("input, textarea"))
              .map(el => (el.value || "").trim());
        if (values.some(v => v)) hasAnyExpData = true;
      });
      expCard.classList.toggle("card-error", !hasAnyExpData);
    }

        const eduCard = document.getElementById("education");
        if (eduCard) {
          const eduItems = eduCard.querySelectorAll(".edu-item");
          let hasAnyEduData = false;
          eduItems.forEach(item => {
            const values = Array.from(item.querySelectorAll("input, textarea"))
              .map(el => (el.value || "").trim());
        if (values.some(v => v)) hasAnyEduData = true;
      });
      eduCard.classList.toggle("card-error", !hasAnyEduData);
    }
  }

  // ===== Block Creators =====
      function createExperienceBlock(exp, index) {
        const wrap = document.createElement("div");
        wrap.className = "item-block exp-item";
        wrap.dataset.index = index;
        wrap.innerHTML = `
          <div class="item-header">
            <div class="item-title">${exp.title || "–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã"}</div>
            <div class="item-index">–û–ø—ã—Ç ${index + 1}</div>
          </div>
          <div class="field-row">
            <div class="field">
              <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
              <input type="text" data-field="title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Senior Backend Engineer">
            </div>
            <div class="field">
              <label>–ö–æ–º–ø–∞–Ω–∏—è</label>
              <input type="text" data-field="company" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: BrainStarsTech">
            </div>
          </div>
          <div class="field-row">
            <div class="field">
              <label>–ì–æ—Ä–æ–¥ / —Å—Ç—Ä–∞–Ω–∞</label>
              <input type="text" data-field="location" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Varna, Bulgaria">
            </div>
            <div class="field">
              <label>–ü–µ—Ä–∏–æ–¥ —Ä–∞–±–æ—Ç—ã</label>
              <input type="text" data-field="period" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –æ–∫—Ç—è–±—Ä—å 2021 ‚Äî –ø–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è">
            </div>
          </div>
      <div class="field-row">
            <div class="field">
              <label>–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏</label>
          <textarea data-field="description" placeholder="–ö—Ä–∞—Ç–∫–æ —á–µ–º –∑–∞–Ω–∏–º–∞–ª—Å—è –∫–∞–Ω–¥–∏–¥–∞—Ç –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏..."></textarea>
            </div>
          </div>
        `;
        wrap.querySelector('[data-field="title"]').value = exp.title || "";
        wrap.querySelector('[data-field="company"]').value = exp.company || "";
        wrap.querySelector('[data-field="location"]').value = exp.location || "";
        wrap.querySelector('[data-field="period"]').value = exp.period || "";
        wrap.querySelector('[data-field="description"]').value = exp.description || "";
        return wrap;
      }

      function createEducationBlock(edu, index) {
        const wrap = document.createElement("div");
        wrap.className = "item-block edu-item";
        wrap.dataset.index = index;
        wrap.innerHTML = `
          <div class="item-header">
            <div class="item-title">${edu.university || "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"}</div>
            <div class="item-index">–ó–∞–ø–∏—Å—å ${index + 1}</div>
          </div>
          <div class="field-row">
            <div class="field">
              <label>–£—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ</label>
          <input type="text" data-field="university" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Khabarovsk's Russian State Technological University">
            </div>
            <div class="field">
              <label>–°—Ç–µ–ø–µ–Ω—å / —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</label>
              <input type="text" data-field="degree" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: M.Sc. in Computer Science">
            </div>
          </div>
      <div class="field-row">
            <div class="field">
              <label>–ü–µ—Ä–∏–æ–¥ –æ–±—É—á–µ–Ω–∏—è</label>
              <input type="text" data-field="period" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω–æ—è–±—Ä—å 1989 ‚Äî –Ω–æ—è–±—Ä—å 1995">
            </div>
          </div>
        `;
        wrap.querySelector('[data-field="university"]').value = edu.university || "";
        wrap.querySelector('[data-field="degree"]').value = edu.degree || "";
        wrap.querySelector('[data-field="period"]').value = edu.period || "";
        return wrap;
      }

      function createCourseBlock(course, index) {
        const wrap = document.createElement("div");
        wrap.className = "item-block course-item";
        wrap.dataset.index = index;
        wrap.innerHTML = `
          <div class="item-header">
            <div class="item-title">${course.name || "–ö—É—Ä—Å / —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"}</div>
            <div class="item-index">–ö—É—Ä—Å ${index + 1}</div>
          </div>
          <div class="field-row">
            <div class="field">
              <label>–ö—É—Ä—Å / —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</label>
              <input type="text" data-field="name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Kubernetes for Developers">
            </div>
            <div class="field">
              <label>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</label>
              <input type="text" data-field="organization" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Coursera, Udemy, Oracle">
            </div>
          </div>
      <div class="field-row">
            <div class="field">
              <label>–ì–æ–¥ / –ø–µ—Ä–∏–æ–¥</label>
              <input type="text" data-field="year" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 2023">
            </div>
          </div>
        `;
        wrap.querySelector('[data-field="name"]').value = course.name || "";
        wrap.querySelector('[data-field="organization"]').value = course.organization || "";
        wrap.querySelector('[data-field="year"]').value = course.year || "";
        return wrap;
      }

      function createProjectBlock(project, index) {
        const wrap = document.createElement("div");
        wrap.className = "item-block project-item";
        wrap.dataset.index = index;
        wrap.innerHTML = `
          <div class="item-header">
            <div class="item-title">${project.name || "–ü—Ä–æ–µ–∫—Ç"}</div>
            <div class="item-index">–ü—Ä–æ–µ–∫—Ç ${index + 1}</div>
          </div>
          <div class="field-row">
            <div class="field">
              <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
              <input type="text" data-field="name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –±–∞–Ω–∫–∞">
            </div>
          </div>
      <div class="field-row">
            <div class="field">
              <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
          <textarea data-field="description" placeholder="–°—Ç–µ–∫, —Ä–æ–ª—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ..."></textarea>
            </div>
          </div>
        `;
        wrap.querySelector('[data-field="name"]').value = project.name || "";
        wrap.querySelector('[data-field="description"]').value = project.description || "";
        return wrap;
      }

  // ===== Render Lists =====
      function renderExperience(list) {
        const container = document.getElementById("experience-list");
        if (!container) return;
        container.innerHTML = "";
        const items = (Array.isArray(list) && list.length) ? list : [{}];
        items.forEach((exp, idx) => {
          container.appendChild(createExperienceBlock(exp || {}, idx));
        });
      }

      function renderEducation(list) {
        const container = document.getElementById("education-list");
        if (!container) return;
        container.innerHTML = "";
        const items = (Array.isArray(list) && list.length) ? list : [{}];
        items.forEach((edu, idx) => {
          container.appendChild(createEducationBlock(edu || {}, idx));
        });
      }

      function renderCourses(list) {
        const container = document.getElementById("courses-list");
        if (!container) return;
        container.innerHTML = "";
        const items = (Array.isArray(list) && list.length) ? list : [{}];
        items.forEach((course, idx) => {
          container.appendChild(createCourseBlock(course || {}, idx));
        });
      }

      function renderProjects(list) {
        const container = document.getElementById("projects-list");
        if (!container) return;
        container.innerHTML = "";
        const items = (Array.isArray(list) && list.length) ? list : [{}];
        items.forEach((proj, idx) => {
          container.appendChild(createProjectBlock(proj || {}, idx));
        });
      }

  // ===== Chip Handlers =====
      chips.forEach(chip => {
        chip.addEventListener("click", () => {
          const group = chip.closest(".chips-row").dataset.group;
          if (group === "currencies") {
            chip.classList.toggle("chip-selected");
            const selected = Array.from(
              chip.closest(".chips-row").querySelectorAll(".chip-selected")
            ).map(c => c.dataset.value);
            const hidden = document.querySelector('input[name="currencies"]');
            if (hidden) hidden.value = selected.join(", ");
            highlightRequiredFields();
            return;
          }
          Array.from(chip.closest(".chips-row").querySelectorAll(".chip"))
            .forEach(c => c.classList.remove("chip-selected"));
          chip.classList.add("chip-selected");
          const hidden = document.querySelector('input[name="' + group + '"]');
          if (hidden) hidden.value = chip.dataset.value;
          highlightRequiredFields();
        });
      });

      REQUIRED_FIELDS.forEach((name) => {
        const el = document.querySelector('[name="' + name + '"]');
        if (!el) return;
        el.addEventListener("input", highlightRequiredFields);
        el.addEventListener("change", highlightRequiredFields);
      });

  // ===== Salary Widget =====
      let exchangeRates = null;
      let calculationTimeout = null;
      const HOURS_PER_MONTH = 170; // –†–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –≤ –º–µ—Å—è—Ü

      function calculateRateConversions(baseAmount, rateType, currency) {
        let hourly, monthly, yearly;
        
        if (rateType === 'hourly') {
          hourly = baseAmount;
          monthly = baseAmount * HOURS_PER_MONTH;
          yearly = baseAmount * HOURS_PER_MONTH * 12;
        } else if (rateType === 'monthly') {
          hourly = baseAmount / HOURS_PER_MONTH;
          monthly = baseAmount;
          yearly = baseAmount * 12;
        } else if (rateType === 'yearly') {
          hourly = baseAmount / (HOURS_PER_MONTH * 12);
          monthly = baseAmount / 12;
          yearly = baseAmount;
        }
        
        return {
          hourly: hourly || 0,
          monthly: monthly || 0,
          yearly: yearly || 0
        };
      }

      function updateRateCalculations(baseAmount, rateType, currency) {
        if (!baseAmount || baseAmount <= 0) {
          document.getElementById('calc-hourly').textContent = '‚Äî';
          document.getElementById('calc-monthly').textContent = '‚Äî';
          document.getElementById('calc-yearly').textContent = '‚Äî';
          return;
        }
        
        const conversions = calculateRateConversions(baseAmount, rateType, currency);
        
        const currencySymbols = {
          'RUB': '‚ÇΩ',
          'USD': '$',
          'EUR': '‚Ç¨',
          'BYN': 'Br'
        };
        
        const symbol = currencySymbols[currency] || '';
        
        document.getElementById('calc-hourly').textContent = 
          symbol + formatNumber(conversions.hourly) + ' / —á–∞—Å';
        document.getElementById('calc-monthly').textContent = 
          symbol + formatNumber(conversions.monthly) + ' / –º–µ—Å—è—Ü';
        document.getElementById('calc-yearly').textContent = 
          symbol + formatNumber(conversions.yearly) + ' / –≥–æ–¥';
      }

      async function loadExchangeRates() {
        try {
          const resp = await fetch("/api/currency/rates/current");
          if (resp.ok) {
        exchangeRates = await resp.json();
            return true;
          }
        } catch (err) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç:", err);
        }
        return false;
      }

      async function updateConvertedRates() {
        const amountInput = document.getElementById('base-amount-input');
        const currencySelect = document.getElementById('base-currency-select');
        const rateType = document.getElementById('rate-type-select').value;
        
        const amount = parseFloat(amountInput.value);
        const currency = currencySelect.value;
        
        ['rate-rub', 'rate-usd', 'rate-eur', 'rate-byn'].forEach(id => {
          const el = document.getElementById(id);
          if (el) {
            el.textContent = '...';
            el.classList.add('loading');
          }
        });
        
        const saveBtn = document.getElementById('save-rate-btn');
        const statusEl = document.getElementById('rate-status');
        
        if (!amount || amount <= 0) {
          ['rate-rub', 'rate-usd', 'rate-eur', 'rate-byn'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
              el.textContent = '‚Äî';
              el.classList.remove('loading');
            }
          });
          saveBtn.disabled = true;
          statusEl.textContent = '';
          return;
        }
        
    if (!exchangeRates) await loadExchangeRates();
        
        if (!exchangeRates) {
          statusEl.textContent = '‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç';
          statusEl.className = 'rate-status error';
          saveBtn.disabled = true;
          return;
        }
        
        try {
          const resp = await fetch("/api/currency/calculate-rates", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              base_amount: amount,
              base_currency: currency,
              rate_type: rateType
            })
          });
          
      if (!resp.ok) throw new Error("–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–∞–≤–æ–∫");
          
          const data = await resp.json();
          
          document.getElementById('rate-rub').textContent = formatNumber(data.rate_rub);
          document.getElementById('rate-rub').classList.remove('loading');
          document.getElementById('rate-usd').textContent = formatNumber(data.rate_usd);
          document.getElementById('rate-usd').classList.remove('loading');
          document.getElementById('rate-eur').textContent = formatNumber(data.rate_eur);
          document.getElementById('rate-eur').classList.remove('loading');
          document.getElementById('rate-byn').textContent = formatNumber(data.rate_byn);
          document.getElementById('rate-byn').classList.remove('loading');
          
          document.getElementById('salary_usd_hidden').value = data.rate_usd;
          saveBtn.disabled = false;
          statusEl.textContent = '‚úì –†–∞—Å—Å—á–∏—Ç–∞–Ω–æ';
          statusEl.className = 'rate-status success';
          
        } catch (err) {
          console.error("–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–∞–≤–æ–∫:", err);
          statusEl.textContent = '‚úó –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞';
          statusEl.className = 'rate-status error';
          saveBtn.disabled = true;
        }
      }

      function formatNumber(num) {
        if (!num) return '‚Äî';
    return new Intl.NumberFormat('ru-RU', { maximumFractionDigits: 0 }).format(num);
      }

      async function saveRate() {
        if (!candidateId) {
          alert("–°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞");
          return;
        }
        
        const amountInput = document.getElementById('base-amount-input');
        const currencySelect = document.getElementById('base-currency-select');
        const rateType = document.getElementById('rate-type-select').value;
        const saveBtn = document.getElementById('save-rate-btn');
        const statusEl = document.getElementById('rate-status');
        
        const amount = parseFloat(amountInput.value);
        const currency = currencySelect.value;
        
        if (!amount || amount <= 0) {
          alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É");
          return;
        }
        
        saveBtn.disabled = true;
    saveBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
        statusEl.textContent = '';
        
        try {
          const resp = await fetch(`/api/currency/candidates/${candidateId}/rate`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              base_amount: amount,
              base_currency: currency,
              rate_type: rateType
            })
          });
          
      if (!resp.ok) throw new Error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏");
          
          const data = await resp.json();
          
          document.getElementById('rate-rub').textContent = formatNumber(data.rate_rub);
          document.getElementById('rate-usd').textContent = formatNumber(data.rate_usd);
          document.getElementById('rate-eur').textContent = formatNumber(data.rate_eur);
          document.getElementById('rate-byn').textContent = formatNumber(data.rate_byn);
          document.getElementById('salary_usd_hidden').value = data.rate_usd;
          
          statusEl.textContent = '‚úì –°—Ç–∞–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞';
          statusEl.className = 'rate-status success';
          
          if (saveNotice) {
            saveNotice.textContent = '–°—Ç–∞–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞';
            saveNotice.classList.add("visible");
        setTimeout(() => saveNotice.classList.remove("visible"), 2000);
          }
          
        } catch (err) {
          console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏:", err);
          statusEl.textContent = '‚úó –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è';
          statusEl.className = 'rate-status error';
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞–≤–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
        } finally {
          saveBtn.disabled = false;
      saveBtn.innerHTML = '<i class="bi bi-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞–≤–∫—É';
        }
      }

      function initSalaryWidget() {
        const amountInput = document.getElementById('base-amount-input');
        const currencySelect = document.getElementById('base-currency-select');
        const rateTypeSelect = document.getElementById('rate-type-select');
        const saveBtn = document.getElementById('save-rate-btn');
        
        if (!amountInput || !currencySelect) return;
        
        loadExchangeRates();
        
        amountInput.addEventListener('input', () => {
          clearTimeout(calculationTimeout);
          calculationTimeout = setTimeout(updateConvertedRates, 500);
        });
        
        currencySelect.addEventListener('change', updateConvertedRates);
        rateTypeSelect.addEventListener('change', updateConvertedRates);
        saveBtn.addEventListener('click', saveRate);
      }

  // ===== Load Candidate =====
      async function loadCandidate() {
        if (!candidateId) {
          renderExperience([]);
          renderEducation([]);
          renderCourses([]);
          renderProjects([]);
          highlightRequiredFields();
          return;
        }

        try {
          const resp = await fetch("/candidate/api/" + candidateId, {
            headers: { "Accept": "application/json" }
          });
          if (!resp.ok) {
            console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞");
            renderExperience([]);
            renderEducation([]);
            renderCourses([]);
            renderProjects([]);
            highlightRequiredFields();
            return;
          }
          const data = await resp.json();

          setValue("last_name", data.last_name);
          setValue("first_name", data.first_name);
          setValue("middle_name", data.middle_name);
          setValue("title", data.title);
          setValue("email", data.email);
          setValue("telegram", data.telegram);
          setValue("phone", data.phone || data.whatsapp);
          setValue("linkedin", data.linkedin);
          setValue("github", data.github);
          setValue("portfolio", data.portfolio);
          setValue("about", data.about);

          if (data.base_rate_amount && data.base_rate_currency) {
            document.getElementById('base-amount-input').value = data.base_rate_amount;
            document.getElementById('base-currency-select').value = data.base_rate_currency;
            document.getElementById('rate-type-select').value = data.rate_type || 'monthly';
            updateConvertedRates();
          } else if (data.salary_usd) {
            document.getElementById('base-amount-input').value = data.salary_usd;
            document.getElementById('base-currency-select').value = 'USD';
            updateConvertedRates();
          }
          document.getElementById('salary_usd_hidden').value = data.salary_usd || '';
          setMultiChipGroup("currencies", data.currencies || "RUB, USD, EUR, BYN");
          setChipGroup("grade", data.grade);
          setChipGroup("work_format", data.work_format);
          setChipGroup("employment_type", data.employment_type);
          setValue("company_types", data.company_types);
          setValue("specializations", data.specializations);
          setValue("skills", data.skills);

          setValue("city", data.city);
          setValue("countries", data.countries);
          setValue("timezone", data.timezone);
          setValue("regions", data.regions);
          setValue("preferred_countries", data.preferred_countries);
          setValue("relocation", data.relocation);

          renderExperience(data.experience || []);
          renderEducation(data.education || []);
          renderCourses(data.courses || []);
          renderProjects(data.projects || []);

          setChipGroup("english_level", data.english_level);

          highlightRequiredFields();

        } catch (err) {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ñ–∏–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:", err);
          renderExperience([]);
          renderEducation([]);
          renderCourses([]);
          renderProjects([]);
          highlightRequiredFields();
        }
      }

  // ===== Save Candidate =====
      async function saveCandidate() {
        highlightRequiredFields();

        const payload = {
          last_name: getValue("last_name") || null,
          first_name: getValue("first_name") || null,
          middle_name: getValue("middle_name") || null,
          title: getValue("title") || null,
          email: getValue("email") || null,
          telegram: getValue("telegram") || null,
          phone: getValue("phone") || null,
          whatsapp: getValue("phone") || null,
          linkedin: getValue("linkedin") || null,
          github: getValue("github") || null,
          portfolio: getValue("portfolio") || null,
          about: getValue("about") || null,
          salary_usd: getValue("salary_usd_hidden") ? Number(getValue("salary_usd_hidden")) : null,
          currencies: getValue("currencies") || null,
          grade: getValue("grade") || null,
          work_format: getValue("work_format") || null,
          employment_type: getValue("employment_type") || null,
          company_types: getValue("company_types") || null,
          specializations: getValue("specializations") || null,
          skills: getValue("skills") || null,
          city: getValue("city") || null,
          countries: getValue("countries") || null,
          timezone: getValue("timezone") || null,
          regions: getValue("regions") || "",
          preferred_countries: getValue("preferred_countries") || null,
          relocation: getValue("relocation") || null,
          experience: [],
          education: [],
          courses: [],
          projects: [],
          english_level: getValue("english_level") || null
        };

        const expItems = document.querySelectorAll(".exp-item");
        expItems.forEach(item => {
          const exp = {
            title: (item.querySelector('[data-field="title"]')?.value || "").trim() || null,
            company: (item.querySelector('[data-field="company"]')?.value || "").trim() || null,
            location: (item.querySelector('[data-field="location"]')?.value || "").trim() || null,
            period: (item.querySelector('[data-field="period"]')?.value || "").trim() || null,
            description: (item.querySelector('[data-field="description"]')?.value || "").trim() || null,
          };
      if (Object.values(exp).some(v => v)) payload.experience.push(exp);
        });

        const eduItems = document.querySelectorAll(".edu-item");
        eduItems.forEach(item => {
          const edu = {
            university: (item.querySelector('[data-field="university"]')?.value || "").trim() || null,
            degree: (item.querySelector('[data-field="degree"]')?.value || "").trim() || null,
            period: (item.querySelector('[data-field="period"]')?.value || "").trim() || null,
          };
      if (Object.values(edu).some(v => v)) payload.education.push(edu);
        });

        const courseItems = document.querySelectorAll(".course-item");
        courseItems.forEach(item => {
          const course = {
            name: (item.querySelector('[data-field="name"]')?.value || "").trim() || null,
            organization: (item.querySelector('[data-field="organization"]')?.value || "").trim() || null,
            year: (item.querySelector('[data-field="year"]')?.value || "").trim() || null,
          };
      if (Object.values(course).some(v => v)) payload.courses.push(course);
        });

        const projectItems = document.querySelectorAll(".project-item");
        projectItems.forEach(item => {
          const proj = {
            name: (item.querySelector('[data-field="name"]')?.value || "").trim() || null,
            description: (item.querySelector('[data-field="description"]')?.value || "").trim() || null,
          };
      if (Object.values(proj).some(v => v)) payload.projects.push(proj);
        });

        try {
          const isEdit = Boolean(candidateId);
          const urlParams = new URLSearchParams(window.location.search);
          const taskId = urlParams.get('task_id') || {% if task_id %}'{{ task_id }}'{% else %}null{% endif %};
          
      let url = isEdit ? "/candidate/edit/" + candidateId : "/candidate/create";
      if (isEdit && taskId) url += "?task_id=" + encodeURIComponent(taskId);
          
          const method = isEdit ? "PUT" : "POST";

          const resp = await fetch(url, {
            method: method,
            headers: {
              "Content-Type": "application/json",
              "Accept": "application/json"
            },
            body: JSON.stringify(payload),
          });

          if (!resp.ok) {
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
            return;
          }

          const data = await resp.json();

          if (saveNotice) {
            saveNotice.classList.add("visible");
          }

          setTimeout(() => {
            if (data.redirect_url) {
              window.location.href = data.redirect_url;
            } else {
              window.location.href = "/candidate";
            }
          }, 1500);

        } catch (err) {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:", err);
          alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
        }
      }

  // ===== Navigation & Scroll =====
      menuLinks.forEach(link => {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          const id = link.getAttribute("href").substring(1);
          const target = document.getElementById(id);
          if (!target) return;
          const rect = target.getBoundingClientRect();
      const offset = window.pageYOffset + rect.top - 90; // Account for header
          window.scrollTo({ top: offset, behavior: "smooth" });
        });
      });

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const id = entry.target.id;
            menuLinks.forEach(link => {
              if (link.getAttribute("href") === "#" + id) {
                link.classList.add("active");
              } else {
                link.classList.remove("active");
              }
            });
          }
        });
  }, { root: null, threshold: 0.35 });

      sections.forEach(section => observer.observe(section));

      const saveBtn = document.getElementById("save-btn");
      if (saveBtn) {
        saveBtn.addEventListener("click", saveCandidate);
      }

  // ===== Photo Upload =====
      const photoInput = document.getElementById('photo-input');
      const photoImg = document.getElementById('photo-img');
      const photoPlaceholder = document.getElementById('photo-placeholder');
  const photoPreview = document.getElementById('photo-preview');
      const photoStatus = document.getElementById('photo-status');
      let currentPhotoPath = null;

      photoInput.addEventListener('change', async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        if (!file.type.startsWith('image/')) {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
          return;
        }

        if (file.size > 5 * 1024 * 1024) {
          alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5 –ú–ë');
          return;
        }

        const formData = new FormData();
        formData.append('file', file);

        photoStatus.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
    photoStatus.style.color = 'var(--color-text-primary)';
    photoStatus.style.opacity = '0.85';

        try {
          const resp = await fetch(`/photo/upload/candidate/${candidateId}`, {
            method: 'POST',
            body: formData
          });

          if (!resp.ok) {
            const error = await resp.json();
            throw new Error(error.detail || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
          }

          const data = await resp.json();
          currentPhotoPath = data.photo_path;

          photoImg.src = currentPhotoPath;
          photoImg.style.display = 'block';
          photoPlaceholder.style.display = 'none';
      photoPreview.classList.add('has-photo');

          photoStatus.textContent = '‚úì –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ';
      photoStatus.style.color = '#2ECC71';
        } catch (err) {
          photoStatus.textContent = '‚úó –û—à–∏–±–∫–∞: ' + err.message;
      photoStatus.style.color = '#E74C3C';
        }
      });

      async function loadPhoto() {
        if (!candidateId) return;
        try {
          const resp = await fetch(`/candidate/api/${candidateId}`);
          if (resp.ok) {
            const data = await resp.json();
            if (data.photo_path) {
              currentPhotoPath = data.photo_path;
              photoImg.src = currentPhotoPath;
              photoImg.style.display = 'block';
              photoPlaceholder.style.display = 'none';
          photoPreview.classList.add('has-photo');
            } else {
              photoImg.style.display = 'none';
              photoPlaceholder.style.display = 'flex';
          photoPreview.classList.remove('has-photo');
            }
          }
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:', err);
          photoImg.style.display = 'none';
          photoPlaceholder.style.display = 'flex';
      photoPreview.classList.remove('has-photo');
    }
  }

  // ===== Resume Update Modal =====
      const updateResumeBtn = document.getElementById("update-resume-btn");
      const updateResumeModal = document.getElementById("update-resume-modal");
      const closeModalBtn = document.getElementById("close-modal-btn");
      const cancelUpdateBtn = document.getElementById("cancel-update-btn");
      const resumeFileInput = document.getElementById("resume-file-input");
      const submitUpdateBtn = document.getElementById("submit-update-btn");
      const fileStatus = document.getElementById("file-status");

      function openModal() {
        if (!candidateId) {
          alert("–°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞");
          return;
        }
        updateResumeModal.classList.add("visible");
        resumeFileInput.value = "";
        fileStatus.textContent = "";
        fileStatus.className = "file-status";
        submitUpdateBtn.disabled = true;
      }

      function closeModal() {
        updateResumeModal.classList.remove("visible");
      }

  if (updateResumeBtn) updateResumeBtn.addEventListener("click", openModal);
  if (closeModalBtn) closeModalBtn.addEventListener("click", closeModal);
  if (cancelUpdateBtn) cancelUpdateBtn.addEventListener("click", closeModal);

      if (updateResumeModal) {
        updateResumeModal.addEventListener("click", (e) => {
      if (e.target === updateResumeModal) closeModal();
        });
      }

      resumeFileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const ext = file.name.split('.').pop().toLowerCase();
          if (!['pdf', 'docx', 'txt', 'rtf'].includes(ext)) {
            fileStatus.textContent = "‚úó –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PDF, DOCX, TXT –∏–ª–∏ RTF";
            fileStatus.className = "file-status error";
            submitUpdateBtn.disabled = true;
            return;
          }
          if (file.size > 10 * 1024 * 1024) {
            fileStatus.textContent = "‚úó –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 10 –ú–ë";
            fileStatus.className = "file-status error";
            submitUpdateBtn.disabled = true;
            return;
          }
          fileStatus.textContent = `‚úì –í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: ${file.name}`;
          fileStatus.className = "file-status success";
          submitUpdateBtn.disabled = false;
        } else {
          fileStatus.textContent = "";
          fileStatus.className = "file-status";
          submitUpdateBtn.disabled = true;
        }
      });

      if (submitUpdateBtn) {
        submitUpdateBtn.addEventListener("click", async () => {
          if (!candidateId) {
            alert("–°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞");
            return;
          }

          const file = resumeFileInput.files[0];
          if (!file) {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª");
            return;
          }

          submitUpdateBtn.disabled = true;
      submitUpdateBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>–û–±—Ä–∞–±–æ—Ç–∫–∞...';
          fileStatus.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—é–º–µ...";
          fileStatus.className = "file-status";

          const formData = new FormData();
          formData.append("file", file);

          try {
            const resp = await fetch(`/candidate/update-resume/${candidateId}`, {
              method: "POST",
              body: formData
            });

            if (!resp.ok) {
              const error = await resp.json();
              throw new Error(error.detail || "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–µ–∑—é–º–µ");
            }

            const data = await resp.json();
            fileStatus.textContent = "‚úì –†–µ–∑—é–º–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!";
            fileStatus.className = "file-status success";

            setTimeout(() => {
              closeModal();
              loadCandidate();
              if (saveNotice) {
                saveNotice.textContent = "–†–µ–∑—é–º–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ";
                saveNotice.classList.add("visible");
            setTimeout(() => saveNotice.classList.remove("visible"), 2000);
              }
            }, 1500);

          } catch (err) {
            fileStatus.textContent = `‚úó –û—à–∏–±–∫–∞: ${err.message}`;
            fileStatus.className = "file-status error";
            submitUpdateBtn.disabled = false;
        submitUpdateBtn.innerHTML = '<i class="bi bi-upload me-2"></i>–û–±–Ω–æ–≤–∏—Ç—å';
          }
        });
      }

  // ===== Initialize =====
  loadCandidate();
  loadPhoto();
  initSalaryWidget();
    });
  </script>
{% endblock %}
