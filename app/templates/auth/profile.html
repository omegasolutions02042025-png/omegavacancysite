{% extends "layouts/base.html" %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å ‚Äî Omega Hire{% endblock %}

{% block head %}
  <style>
    .profile-page{
      max-width:100%;
      margin:0;
      padding:0;
      display:flex;
      flex-direction:column;
      gap:20px;
    }
    .profile-main{
      flex:1;
    }
    .profile-card {
      background: var(--color-bg-surface);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-radius: 16px;
      padding: 40px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 30px rgba(255, 215, 0, 0.05);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .profile-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent 0%, 
        var(--color-accent-gold) 50%, 
        transparent 100%);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }
    .profile-title{
      margin:0 0 10px;
      font-size:1.6rem;
      font-weight:700;
      color: var(--color-text-heading);
      text-shadow: 
        0 0 20px rgba(255, 215, 0, 0.3),
        0 2px 4px rgba(0, 0, 0, 0.3);
    }
    .profile-email{
      font-size:1rem;
      color: var(--color-text-primary);
      font-weight:600;
      margin-bottom:8px;
    }
    .profile-sub{
      font-size:0.9rem;
      color: var(--color-text-muted);
      margin-bottom:18px;
    }
    .profile-actions{
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
    }
    .btn-outline {
      padding: 12px 24px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: var(--color-bg-surface-2);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: var(--color-text-heading);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s ease;
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    .btn-outline:hover {
      background: var(--color-bg-surface);
      border-color: rgba(255, 215, 0, 0.3);
      color: var(--color-accent-gold);
      transform: translateY(-2px);
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.2),
        0 0 20px rgba(255, 215, 0, 0.15);
    }

    /* –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å" */
    .btn-primary-link {
      border: none;
      background: var(--gradient-gold);
      color: #0A1929;
      box-shadow: 
        0 8px 24px rgba(255, 215, 0, 0.4),
        0 0 30px rgba(255, 215, 0, 0.2);
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .btn-primary-link:hover {
      background: linear-gradient(135deg, #FFE066 0%, var(--color-accent-gold) 100%);
      transform: translateY(-2px);
      box-shadow: 
        0 12px 32px rgba(255, 215, 0, 0.6),
        0 0 40px rgba(255, 215, 0, 0.4);
    }
    .btn-logout {
      margin-top: 24px;
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }
    .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
    }

    .tg-linked{
      font-size:0.85rem;
      margin-top:12px;
      color:#2ECC71;
    }
    .tg-linked-missing{
      color: var(--color-text-muted);
    }
    .profile-field{
      margin-bottom:12px;
      font-size:0.95rem;
      line-height:1.5;
      color: var(--color-text-primary);
    }
    .profile-field strong{
      color: var(--color-text-heading);
      display:inline-block;
      min-width:140px;
    }

    /* ========= –û–ë–©–ò–ï –°–¢–ò–õ–ò –ú–û–î–ê–õ–û–ö ========= */
    body.modal-open {
      overflow: hidden;
    }
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
    }
    .modal-card {
      width: 100%;
      max-width: 460px;
      max-height: 90vh;
      background: var(--color-bg-surface);
      backdrop-filter: blur(30px) saturate(180%);
      -webkit-backdrop-filter: blur(30px) saturate(180%);
      color: var(--color-text-heading);
      border-radius: 24px;
      padding: 32px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 40px rgba(255, 215, 0, 0.1);
      overflow-y: auto;
      margin: auto;
      position: relative;
    }
    .modal-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent 0%, 
        var(--color-accent-gold) 50%, 
        transparent 100%);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }
    .modal-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }
    .modal-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--color-text-heading);
      text-shadow: 
        0 0 20px rgba(255, 215, 0, 0.3),
        0 2px 4px rgba(0, 0, 0, 0.3);
    }
    .modal-close {
      background: none;
      border: none;
      color: var(--color-text-muted);
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .modal-close:hover {
      color: var(--color-accent-gold);
      transform: scale(1.1);
    }
    .modal-card p {
      font-size: 0.95rem;
      color: var(--color-text-primary);
      margin-bottom: 16px;
      line-height: 1.6;
    }
    .modal-field{
      text-align:left;
      margin-bottom:10px;
    }
    .modal-label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--color-text-heading);
    }
    .modal-input {
      width: 100%;
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.15) !important;
      background: var(--color-bg-surface-2) !important;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: var(--color-text-heading) !important;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    .modal-input::placeholder,
    .modal-input::-webkit-input-placeholder,
    .modal-input::-moz-placeholder,
    .modal-input:-ms-input-placeholder,
    .modal-input::-ms-input-placeholder {
      color: var(--color-text-muted) !important;
      opacity: 0.7 !important;
    }
    .modal-input:focus {
      outline: none;
      border-color: var(--color-accent-gold) !important;
      background: var(--color-bg-surface) !important;
      box-shadow: 
        0 0 0 2px rgba(255, 215, 0, 0.2),
        0 0 20px rgba(255, 215, 0, 0.15),
        0 4px 12px rgba(0, 0, 0, 0.2) !important;
    }
    textarea.modal-input {
      resize: vertical;
      font-family: inherit;
    }
    .modal-actions{
      display:flex;
      justify-content:flex-end;
      gap:8px;
      margin-top:12px;
    }
    .modal-btn{
      padding:8px 14px;
      border-radius:12px;
      border:none;
      font-size:0.85rem;
      font-weight:600;
      cursor:pointer;
      transition: all 0.3s ease;
    }
    .modal-btn-primary {
      background: var(--gradient-gold);
      color: #0A1929;
      box-shadow: 
        0 4px 15px rgba(255, 215, 0, 0.4),
        0 0 20px rgba(255, 215, 0, 0.2);
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    .modal-btn-primary:hover {
      background: linear-gradient(135deg, #FFE066 0%, var(--color-accent-gold) 100%);
      transform: translateY(-2px);
      box-shadow: 
        0 8px 24px rgba(255, 215, 0, 0.6),
        0 0 30px rgba(255, 215, 0, 0.4);
    }
    .modal-btn-secondary {
      background: var(--color-bg-surface-2);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: var(--color-text-heading);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    .modal-btn-secondary:hover {
      background: var(--color-bg-surface);
      border-color: rgba(255, 215, 0, 0.3);
      color: var(--color-accent-gold);
      transform: translateY(-2px);
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.2),
        0 0 20px rgba(255, 215, 0, 0.15);
    }
    .modal-status{
      margin-top:8px;
      font-size:0.8rem;
      min-height:1em;
    }
    .modal-status-error {
      color: #E74C3C;
      font-weight: 600;
    }
    .modal-status-ok {
      color: #2ECC71;
      font-weight: 600;
    }
  </style>
{% endblock %}

{% block content %}
  <div class="container-fluid p-4">
    <div class="row">
      <div class="col-lg-3 mb-4">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title mb-3" style="color: var(--color-accent-gold);">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h5>
            <nav class="d-flex flex-column gap-2">
              <a href="/sverka/history" class="btn btn-ghost text-start">
                <i class="bi bi-folder me-2"></i>–ò—Å—Ç–æ—Ä–∏—è —Å–≤–µ—Ä–∫–∏
              </a>
              <a href="/candidate" class="btn btn-ghost text-start">
                <i class="bi bi-people me-2"></i>–ú–æ–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã
              </a>
            </nav>
          </div>
        </div>
      </div>
      <div class="col-lg-9">
        <div class="card">
          <div class="card-body">
            <main class="profile-page" style="max-width: 100%; margin: 0; padding: 0;">
    <aside class="profile-sidebar">
      <div>
        <div class="sidebar-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</div>
        <nav class="sidebar-menu">
          <a href="/sverka/history" class="sidebar-link">
            <span class="icon">üìÇ</span>
            <span>–ò—Å—Ç–æ—Ä–∏—è —Å–≤–µ—Ä–∫–∏</span>
          </a>
          <a href="/candidate" class="sidebar-link">
            <span class="icon">üë•</span>
            <span>–ú–æ–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã</span>
          </a>
        </nav>
      </div>
    </aside>

    <section class="profile-main">
      <div class="profile-card">
        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 24px;">
          <div id="user-photo-preview" style="width: 120px; height: 120px; border-radius: 50%; background: var(--color-bg-surface-2); display: flex; align-items: center; justify-content: center; overflow: hidden; border: 3px solid rgba(255, 215, 0, 0.3); margin-bottom: 12px; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);">
            <img id="user-photo-img" src="" alt="" style="width: 100%; height: 100%; object-fit: cover; display: none;">
            <i class="bi bi-person-fill" id="user-photo-placeholder" style="font-size: 3rem; color: var(--color-text-muted);"></i>
          </div>
          <input type="file" id="user-photo-input" accept="image/*" style="display: none;">
          <button type="button" onclick="document.getElementById('user-photo-input').click()" class="btn-outline" style="margin-bottom: 8px;">
            <i class="bi bi-camera me-2"></i>–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ
          </button>
          <div id="user-photo-status" style="font-size: 0.85rem; color: var(--color-text-muted); min-height: 1.2em;"></div>
        </div>

        <h1 class="profile-title">–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h1>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ -->
        <div id="profile-info" style="text-align: left; margin: 24px 0;">
          <div class="profile-field">
            <strong>–§–ò–û:</strong> 
            <span id="profile-fullname">
              {% if user_first_name or user_last_name or user_middle_name %}
                {% set parts = [] %}
                {% if user_last_name %}{% set _ = parts.append(user_last_name) %}{% endif %}
                {% if user_first_name %}{% set _ = parts.append(user_first_name) %}{% endif %}
                {% if user_middle_name %}{% set _ = parts.append(user_middle_name) %}{% endif %}
                {{ parts|join(' ') }}
              {% else %}
                <span style="color: var(--color-text-muted);">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
              {% endif %}
            </span>
          </div>
          <div class="profile-field">
            <strong>Email:</strong> 
            <span id="profile-email">{{ user_email or "email –Ω–µ –Ω–∞–π–¥–µ–Ω" }}</span>
          </div>
          <div class="profile-field">
            <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> 
            <span id="profile-phone">
              {% if user_phone %}
                {{ user_phone }}
              {% else %}
                <span style="color: var(--color-text-muted);">–ù–µ —É–∫–∞–∑–∞–Ω</span>
              {% endif %}
            </span>
          </div>
          <div class="profile-field">
            <strong>Telegram:</strong> 
            <span id="profile-telegram">
              {% if telegram_username %}
                @{{ telegram_username }}
              {% else %}
                <span style="color: var(--color-text-muted);">–ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω</span>
              {% endif %}
            </span>
          </div>
          <div class="profile-field">
            <strong>–†–∞–±–æ—á–∏–π e-mail:</strong> 
            <span id="profile-work-email">
              {% if linked_email %}
                {{ linked_email }}
              {% else %}
                <span style="color: var(--color-text-muted);">–ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω</span>
              {% endif %}
            </span>
          </div>
          <div class="profile-field">
            <strong>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</strong> 
            <span id="profile-specialization">
              {% if user_specialization %}
                {{ user_specialization }}
              {% else %}
                <span style="color: var(--color-text-muted);">–ù–µ —É–∫–∞–∑–∞–Ω–∞</span>
              {% endif %}
            </span>
          </div>
          <div class="profile-field">
            <strong>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã:</strong> 
            <div id="profile-experience" style="margin-top: 4px; color: var(--color-text-primary); white-space: pre-wrap;">
              {% if user_experience %}
                {{ user_experience }}
              {% else %}
                <span style="color: var(--color-text-muted);">–ù–µ —É–∫–∞–∑–∞–Ω</span>
              {% endif %}
            </div>
          </div>
          <div class="profile-field">
            <strong>–†–µ–∑—é–º–µ:</strong> 
            <div id="profile-resume" style="margin-top: 4px; color: var(--color-text-primary); white-space: pre-wrap;">
              {% if user_resume %}
                {{ user_resume }}
              {% else %}
                <span style="color: var(--color-text-muted);">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
              {% endif %}
            </div>
          </div>
        </div>

        <p class="profile-sub">
          –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–≤–µ—Ä–∫—É –≤–∞–∫–∞–Ω—Å–∏–π –∏ –≤–µ—Å—Ç–∏ –ø–µ—Ä–µ–ø–∏—Å–∫—É —Å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏.
        </p>

        <div class="profile-actions">
          <button type="button" class="btn-outline btn-primary-link" onclick="openEditProfileModal()">
            <i class="bi bi-pencil me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
          </button>

          {% if telegram_username %}
            <button type="button" class="btn-outline" onclick="unlinkTelegram()">
              <i class="bi bi-x-circle me-2"></i>–û—Ç–≤—è–∑–∞—Ç—å Telegram
            </button>
          {% else %}
            <button type="button" class="btn-outline" onclick="openTelegramModal()">
              <i class="bi bi-link-45deg me-2"></i>–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram
            </button>
          {% endif %}

          {% if linked_email %}
            <button type="button" class="btn-outline" onclick="unlinkEmail()">
              <i class="bi bi-x-circle me-2"></i>–û—Ç–≤—è–∑–∞—Ç—å e-mail
            </button>
          {% else %}
            <button type="button" class="btn-outline" onclick="openEmailModal()">
              <i class="bi bi-envelope me-2"></i>–ü—Ä–∏–≤—è–∑–∞—Ç—å e-mail
            </button>
          {% endif %}
        </div>

        <button class="btn-logout" onclick="logout()">–í—ã–π—Ç–∏</button>
      </div>
            </section>
          </main>
        </div>
      </div>
    </div>
  </div>

  <!-- ========= –ú–û–î–ê–õ–ö–ê TELEGRAM ========= -->
  <div id="tg-modal-root" style="display:none;">
    <div class="modal-backdrop" onclick="if(event.target === this) closeTelegramModal()">
      <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-title">–ü—Ä–∏–≤—è–∑–∫–∞ Telegram</div>
          <button class="modal-close" type="button" onclick="closeTelegramModal()">√ó</button>
        </div>
        <p>–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ Telegram, –∑–∞—Ç–µ–º –∫–æ–¥ –∏–∑ Telegram. –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ 2FA ‚Äî –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å.</p>

        <!-- –®–∞–≥ 1 ‚Äî —Ç–µ–ª–µ—Ñ–æ–Ω -->
        <form id="tg-step-phone" onsubmit="sendTelegramCode(event)">
          <div class="modal-field">
            <label class="modal-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
            <input class="modal-input" type="text" name="phone" placeholder="+375XXXXXXXXX" required>
          </div>
          <div class="modal-actions">
            <button type="button" class="modal-btn modal-btn-secondary" onclick="closeTelegramModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="modal-btn modal-btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</button>
          </div>
        </form>

        <!-- –®–∞–≥ 2 ‚Äî –∫–æ–¥ -->
        <form id="tg-step-code" onsubmit="confirmTelegramCode(event)" style="display:none;">
          <div class="modal-field">
            <label class="modal-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
            <input class="modal-input" type="text" name="phone" readonly>
          </div>
          <div class="modal-field">
            <label class="modal-label">–ö–æ–¥ –∏–∑ Telegram</label>
            <input class="modal-input" type="text" name="code" placeholder="12345" required>
          </div>
          <div class="modal-actions">
            <button type="button" class="modal-btn modal-btn-secondary" onclick="backToPhoneStep()">–ù–∞–∑–∞–¥</button>
            <button type="submit" class="modal-btn modal-btn-primary">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥</button>
          </div>
        </form>

        <!-- –®–∞–≥ 3 ‚Äî –æ–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å -->
        <form id="tg-step-password" onsubmit="confirmTelegramPassword(event)" style="display:none;">
          <div class="modal-field">
            <label class="modal-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
            <input class="modal-input" type="text" name="phone" readonly>
          </div>
          <div class="modal-field">
            <label class="modal-label">–û–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å (2FA)</label>
            <input class="modal-input" type="password" name="password" placeholder="–í–∞—à –æ–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å Telegram" required>
          </div>
          <div class="modal-actions">
            <button type="button" class="modal-btn modal-btn-secondary" onclick="backToCodeStep()">–ù–∞–∑–∞–¥</button>
            <button type="submit" class="modal-btn modal-btn-primary">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
          </div>
        </form>

        <div id="tg-status" class="modal-status"></div>
      </div>
    </div>
  </div>

  <!-- ========= –ú–û–î–ê–õ–ö–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ü–†–û–§–ò–õ–Ø ========= -->
  <div id="edit-profile-modal-root" style="display:none;">
    <div class="modal-backdrop" onclick="if(event.target === this) closeEditProfileModal()">
      <div class="modal-card" style="max-width: 600px;" onclick="event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</div>
          <button class="modal-close" type="button" onclick="closeEditProfileModal()">√ó</button>
        </div>
        <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–±–µ. –í—Å–µ –ø–æ–ª—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.</p>

        <form id="edit-profile-form" onsubmit="saveProfile(event)">
          <div class="modal-field">
            <label class="modal-label">–§–∞–º–∏–ª–∏—è</label>
            <input class="modal-input" type="text" name="last_name" id="edit-last-name" placeholder="–ò–≤–∞–Ω–æ–≤">
          </div>
          <div class="modal-field">
            <label class="modal-label">–ò–º—è</label>
            <input class="modal-input" type="text" name="first_name" id="edit-first-name" placeholder="–ò–≤–∞–Ω">
          </div>
          <div class="modal-field">
            <label class="modal-label">–û—Ç—á–µ—Å—Ç–≤–æ</label>
            <input class="modal-input" type="text" name="middle_name" id="edit-middle-name" placeholder="–ò–≤–∞–Ω–æ–≤–∏—á">
          </div>
          <div class="modal-field">
            <label class="modal-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input class="modal-input" type="text" name="phone" id="edit-phone" placeholder="+375XXXXXXXXX">
          </div>
          <div class="modal-field">
            <label class="modal-label">–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</label>
            <input class="modal-input" type="text" name="specialization" id="edit-specialization" placeholder="IT-—Ä–µ–∫—Ä—É—Ç–µ—Ä, HR-–º–µ–Ω–µ–¥–∂–µ—Ä">
          </div>
          <div class="modal-field">
            <label class="modal-label">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</label>
            <textarea class="modal-input" name="experience" id="edit-experience" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –≤ —Ä–µ–∫—Ä—É—Ç–∏–Ω–≥–µ..."></textarea>
          </div>
          <div class="modal-field">
            <label class="modal-label">–†–µ–∑—é–º–µ</label>
            <textarea class="modal-input" name="resume" id="edit-resume" rows="6" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–±–µ, –Ω–∞–≤—ã–∫–∞—Ö, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö..."></textarea>
          </div>
          <div class="modal-actions">
            <button type="button" class="modal-btn modal-btn-secondary" onclick="closeEditProfileModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="modal-btn modal-btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </form>

        <div id="edit-profile-status" class="modal-status"></div>
      </div>
    </div>
  </div>

  <!-- ========= –ú–û–î–ê–õ–ö–ê E-MAIL ========= -->
  <div id="email-modal-root" style="display:none;">
    <div class="modal-backdrop" onclick="if(event.target === this) closeEmailModal()">
      <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-title">–ü—Ä–∏–≤—è–∑–∫–∞ e-mail</div>
          <button class="modal-close" type="button" onclick="closeEmailModal()">√ó</button>
        </div>
        <p>–°–Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à e-mail, –∑–∞—Ç–µ–º –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (IMAP/SMTP).–í–æ—Ç —Å—Å—ã–ª–∫–∞ –∫–∞–∫ –µ–≥–æ —Å–æ–∑–¥–∞—Ç—å:
          <a href = 'https://support.google.com/accounts/answer/185833'>–ü–µ—Ä–µ–π—Ç–∏</a>
        </p>

        <!-- –®–∞–≥ 1 ‚Äî e-mail -->
        <form id="email-step-address" onsubmit="sendEmailInit(event)">
          <div class="modal-field">
            <label class="modal-label">E-mail</label>
            <input class="modal-input" type="email" name="email" placeholder="you@example.com" required>
          </div>
          <div class="modal-actions">
            <button type="button" class="modal-btn modal-btn-secondary" onclick="closeEmailModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="modal-btn modal-btn-primary">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
          </div>
        </form>

        <!-- –®–∞–≥ 2 ‚Äî –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
        <form id="email-step-password" onsubmit="confirmEmailPassword(event)" style="display:none;">
          <div class="modal-field">
            <label class="modal-label">E-mail</label>
            <input class="modal-input" type="email" name="email" readonly>
          </div>
          <div class="modal-field">
            <label class="modal-label">–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</label>
            <input class="modal-input" type="password" name="app_password" placeholder="–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (IMAP/SMTP)" required>
          </div>
          <div class="modal-actions">
            <button type="button" class="modal-btn modal-btn-secondary" onclick="backToEmailStep()">–ù–∞–∑–∞–¥</button>
            <button type="submit" class="modal-btn modal-btn-primary">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
          </div>
        </form>

        <div id="email-status" class="modal-status"></div>
      </div>
    </div>
  </div>

  <script>
    function logout(){
        window.location.href = "/auth/logout";
    }

    /* ===== TELEGRAM ===== */

    function openTelegramModal(){
      const root = document.getElementById('tg-modal-root');
      const s1 = document.getElementById('tg-step-phone');
      const s2 = document.getElementById('tg-step-code');
      const s3 = document.getElementById('tg-step-password');
      const statusEl = document.getElementById('tg-status');

      s1.style.display = 'block';
      s2.style.display = 'none';
      s3.style.display = 'none';
      statusEl.textContent = '';
      statusEl.className = 'modal-status';

      root.style.display = 'block';
      document.body.classList.add('modal-open');
    }

    function closeTelegramModal(){
      document.getElementById('tg-modal-root').style.display = 'none';
      document.body.classList.remove('modal-open');
    }

    function backToPhoneStep(){
      document.getElementById('tg-step-phone').style.display = 'block';
      document.getElementById('tg-step-code').style.display = 'none';
      document.getElementById('tg-step-password').style.display = 'none';
    }

    function backToCodeStep(){
      document.getElementById('tg-step-phone').style.display = 'none';
      document.getElementById('tg-step-code').style.display = 'block';
      document.getElementById('tg-step-password').style.display = 'none';
    }

    async function sendTelegramCode(event){
      event.preventDefault();
      const form = document.getElementById('tg-step-phone');
      const phone = form.phone.value.trim();
      const statusEl = document.getElementById('tg-status');

      statusEl.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥...';
      statusEl.className = 'modal-status';

      try{
        const resp = await fetch('/telegram/send-code', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: new URLSearchParams({ phone })
        });
        const data = await resp.json();

        if (resp.ok && data.ok){
          statusEl.textContent = data.message || '–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram.';
          statusEl.className = 'modal-status modal-status-ok';

          const stepCode = document.getElementById('tg-step-code');
          stepCode.phone.value = phone;
          form.style.display = 'none';
          stepCode.style.display = 'block';
        } else {
          statusEl.textContent = data.detail || data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞';
          statusEl.className = 'modal-status modal-status-error';
        }
      } catch(e){
        statusEl.textContent = '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + e;
        statusEl.className = 'modal-status modal-status-error';
      }
    }

    async function confirmTelegramCode(event){
      event.preventDefault();
      const form = document.getElementById('tg-step-code');
      const phone = form.phone.value.trim();
      const code = form.code.value.trim();
      const statusEl = document.getElementById('tg-status');

      statusEl.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥...';
      statusEl.className = 'modal-status';

      try{
        const resp = await fetch('/telegram/confirm-code', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: new URLSearchParams({ phone, code })
        });
        const data = await resp.json();

        if (!resp.ok){
          statusEl.textContent = data.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∫–æ–¥–∞';
          statusEl.className = 'modal-status modal-status-error';
          return;
        }

        if (data.need_password){
          statusEl.textContent = data.message || '–î–ª—è —ç—Ç–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤–∫–ª—é—á—ë–Ω –æ–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å, –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ.';
          statusEl.className = 'modal-status';

          const stepPwd = document.getElementById('tg-step-password');
          stepPwd.phone.value = phone;

          form.style.display = 'none';
          stepPwd.style.display = 'block';
        } else {
          statusEl.textContent = data.message || 'Telegram —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω.';
          statusEl.className = 'modal-status modal-status-ok';
          setTimeout(() => location.reload(), 800);
        }
      } catch(e){
        statusEl.textContent = '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + e;
        statusEl.className = 'modal-status modal-status-error';
      }
    }

    async function confirmTelegramPassword(event){
      event.preventDefault();
      const form = document.getElementById('tg-step-password');
      const phone = form.phone.value.trim();
      const password = form.password.value.trim();
      const statusEl = document.getElementById('tg-status');

      statusEl.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ø–∞—Ä–æ–ª—å...';
      statusEl.className = 'modal-status';

      try{
        const resp = await fetch('/telegram/password', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: new URLSearchParams({ phone, password })
        });
        const data = await resp.json();

        if (resp.ok && data.ok){
          statusEl.textContent = data.message || 'Telegram —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω.';
          statusEl.className = 'modal-status modal-status-ok';
          setTimeout(() => location.reload(), 800);
        } else {
          statusEl.textContent = data.detail || data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è';
          statusEl.className = 'modal-status modal-status-error';
        }
      } catch(e){
        statusEl.textContent = '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + e;
        statusEl.className = 'modal-status modal-status-error';
      }
    }

    async function unlinkTelegram(){
      if (!confirm('–¢–æ—á–Ω–æ –æ—Ç–≤—è–∑–∞—Ç—å Telegram –æ—Ç –ø—Ä–æ—Ñ–∏–ª—è?')){
        return;
      }
      const statusEl = document.getElementById('tg-status') || {textContent:'', className:''};

      try{
        const resp = await fetch('/telegram/unlink', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: new URLSearchParams({})
        });
        const data = await resp.json();

        if (resp.ok && data.ok){
          statusEl.textContent = data.message || 'Telegram –æ—Ç–≤—è–∑–∞–Ω.';
          statusEl.className = 'modal-status modal-status-ok';
          setTimeout(() => location.reload(), 500);
        } else {
          statusEl.textContent = data.detail || data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–≤—è–∑–∫–µ Telegram';
          statusEl.className = 'modal-status modal-status-error';
        }
      } catch(e){
        statusEl.textContent = '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + e;
        statusEl.className = 'modal-status modal-status-error';
      }
    }

    /* ===== E-MAIL ===== */

    function openEmailModal(){
      const root = document.getElementById('email-modal-root');
      const s1 = document.getElementById('email-step-address');
      const s2 = document.getElementById('email-step-password');
      const statusEl = document.getElementById('email-status');

      s1.style.display = 'block';
      s2.style.display = 'none';
      statusEl.textContent = '';
      statusEl.className = 'modal-status';

      root.style.display = 'block';
      document.body.classList.add('modal-open');
    }

    function closeEmailModal(){
      document.getElementById('email-modal-root').style.display = 'none';
      document.body.classList.remove('modal-open');
    }

    function backToEmailStep(){
      document.getElementById('email-step-address').style.display = 'block';
      document.getElementById('email-step-password').style.display = 'none';
    }

    async function sendEmailInit(event){
      event.preventDefault();
      const form = document.getElementById('email-step-address');
      const email = form.email.value.trim();
      const statusEl = document.getElementById('email-status');

      statusEl.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º e-mail...';
      statusEl.className = 'modal-status';

      try{
        const resp = await fetch('/email/connect', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: new URLSearchParams({ email })
        });
        const data = await resp.json();

        if (resp.ok && data.ok){
          statusEl.textContent = data.message || 'E-mail –ø—Ä–∏–Ω—è—Ç. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.';
          statusEl.className = 'modal-status modal-status-ok';

          const stepPwd = document.getElementById('email-step-password');
          stepPwd.email.value = email;
          form.style.display = 'none';
          stepPwd.style.display = 'block';
        } else {
          statusEl.textContent = data.detail || data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ e-mail';
          statusEl.className = 'modal-status modal-status-error';
        }
      } catch(e){
        statusEl.textContent = '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + e;
        statusEl.className = 'modal-status modal-status-error';
      }
    }

    async function confirmEmailPassword(event){
      event.preventDefault();
      const form = document.getElementById('email-step-password');
      const email = form.email.value.trim();
      const appPassword = form.app_password.value.trim();
      const statusEl = document.getElementById('email-status');

      statusEl.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ø–æ—á—Ç–æ–π...';
      statusEl.className = 'modal-status';

      try{
        const resp = await fetch('/email/password', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: new URLSearchParams({ email, password: appPassword })
        });
        const data = await resp.json();

        if (resp.ok && data.ok){
          statusEl.textContent = data.message || 'E-mail —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω.';
          statusEl.className = 'modal-status modal-status-ok';
          setTimeout(() => location.reload(), 800);
        } else {
          statusEl.textContent = data.detail || data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–≤—è–∑–∫–µ e-mail';
          statusEl.className = 'modal-status modal-status-error';
        }
      } catch(e){
        statusEl.textContent = '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + e;
        statusEl.className = 'modal-status modal-status-error';
      }
    }

    async function unlinkEmail(){
      if (!confirm('–¢–æ—á–Ω–æ –æ—Ç–≤—è–∑–∞—Ç—å e-mail –æ—Ç –ø—Ä–æ—Ñ–∏–ª—è?')){
        return;
      }
      const statusEl = document.getElementById('email-status') || {textContent:'', className:''};

      try{
        const resp = await fetch('/email/unlink', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: new URLSearchParams({})
        });
        const data = await resp.json();

        if (resp.ok && data.ok){
          statusEl.textContent = data.message || 'E-mail –æ—Ç–≤—è–∑–∞–Ω.';
          statusEl.className = 'modal-status modal-status-ok';
          setTimeout(() => location.reload(), 500);
        } else {
          statusEl.textContent = data.detail || data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–≤—è–∑–∫–µ e-mail';
          statusEl.className = 'modal-status modal-status-error';
        }
      } catch(e){
        statusEl.textContent = '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + e;
        statusEl.className = 'modal-status modal-status-error';
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userPhotoInput = document.getElementById('user-photo-input');
    const userPhotoImg = document.getElementById('user-photo-img');
    const userPhotoPlaceholder = document.getElementById('user-photo-placeholder');
    const userPhotoStatus = document.getElementById('user-photo-status');

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Ñ–æ—Ç–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    async function loadUserPhoto() {
      try {
        const resp = await fetch('/auth/profile-data');
        if (resp.ok) {
          const data = await resp.json();
          if (data.photo_path) {
            userPhotoImg.src = data.photo_path;
            userPhotoImg.style.display = 'block';
            userPhotoPlaceholder.style.display = 'none';
          } else {
            // –ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder
            userPhotoImg.style.display = 'none';
            userPhotoPlaceholder.style.display = 'flex';
          }
        }
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:', err);
        // –ü—Ä–∏ –æ—à–∏–±–∫–µ —Ç–æ–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder
        userPhotoImg.style.display = 'none';
        userPhotoPlaceholder.style.display = 'flex';
      }
    }

    userPhotoInput.addEventListener('change', async function(e) {
      const file = e.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
        return;
      }

      if (file.size > 5 * 1024 * 1024) {
        alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5 –ú–ë');
        return;
      }

      const formData = new FormData();
      formData.append('file', file);

      userPhotoStatus.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
      userPhotoStatus.style.color = 'var(--color-text-muted)';

      try {
        const resp = await fetch('/photo/upload/user', {
          method: 'POST',
          body: formData
        });

        if (!resp.ok) {
          const error = await resp.json();
          throw new Error(error.detail || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
        }

        const data = await resp.json();

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
        userPhotoImg.src = data.photo_path;
        userPhotoImg.style.display = 'block';
        userPhotoPlaceholder.style.display = 'none';

        userPhotoStatus.textContent = '‚úì –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ';
        userPhotoStatus.style.color = '#2ECC71';
      } catch (err) {
        userPhotoStatus.textContent = '‚úó –û—à–∏–±–∫–∞: ' + err.message;
        userPhotoStatus.style.color = '#E74C3C';
      }
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadUserPhoto();

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à–∏ Escape –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–æ–∫
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const editModal = document.getElementById('edit-profile-modal-root');
        const tgModal = document.getElementById('tg-modal-root');
        const emailModal = document.getElementById('email-modal-root');
        
        if (editModal && editModal.style.display === 'block') {
          closeEditProfileModal();
        } else if (tgModal && tgModal.style.display !== 'none') {
          closeTelegramModal();
        } else if (emailModal && emailModal.style.display !== 'none') {
          closeEmailModal();
        }
      }
    });

    /* ===== –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–§–ò–õ–Ø ===== */

    function openEditProfileModal(){
      const root = document.getElementById('edit-profile-modal-root');
      const statusEl = document.getElementById('edit-profile-status');
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
      loadProfileData();
      
      statusEl.textContent = '';
      statusEl.className = 'modal-status';
      root.style.display = 'block';
      document.body.classList.add('modal-open');
    }

    function closeEditProfileModal(){
      document.getElementById('edit-profile-modal-root').style.display = 'none';
      document.body.classList.remove('modal-open');
    }

    async function loadProfileData(){
      try {
        const resp = await fetch('/auth/profile-data');
        if (resp.ok) {
          const data = await resp.json();
          document.getElementById('edit-first-name').value = data.first_name || '';
          document.getElementById('edit-last-name').value = data.last_name || '';
          document.getElementById('edit-middle-name').value = data.middle_name || '';
          document.getElementById('edit-phone').value = data.phone || '';
          document.getElementById('edit-specialization').value = data.specialization || '';
          document.getElementById('edit-experience').value = data.experience || '';
          document.getElementById('edit-resume').value = data.resume || '';
        }
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è:', err);
      }
    }

    async function saveProfile(event){
      event.preventDefault();
      const form = document.getElementById('edit-profile-form');
      const statusEl = document.getElementById('edit-profile-status');

      const data = {
        first_name: form.first_name.value.trim() || null,
        last_name: form.last_name.value.trim() || null,
        middle_name: form.middle_name.value.trim() || null,
        phone: form.phone.value.trim() || null,
        specialization: form.specialization.value.trim() || null,
        experience: form.experience.value.trim() || null,
        resume: form.resume.value.trim() || null,
      };

      statusEl.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
      statusEl.className = 'modal-status';

      try {
        const resp = await fetch('/auth/update-profile', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(data)
        });

        const result = await resp.json();

        if (resp.ok && result.ok){
          statusEl.textContent = result.message || '–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω.';
          statusEl.className = 'modal-status modal-status-ok';
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
          updateProfileDisplay(data);
          
          setTimeout(() => {
            document.body.classList.remove('modal-open');
            closeEditProfileModal();
            location.reload();
          }, 800);
        } else {
          statusEl.textContent = result.detail || result.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è';
          statusEl.className = 'modal-status modal-status-error';
        }
      } catch(e){
        statusEl.textContent = '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + e;
        statusEl.className = 'modal-status modal-status-error';
      }
    }

    function updateProfileDisplay(data){
      // –û–±–Ω–æ–≤–ª—è–µ–º –§–ò–û
      const fullname = [data.last_name, data.first_name, data.middle_name].filter(Boolean).join(' ') || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
      document.getElementById('profile-fullname').innerHTML = fullname !== '–ù–µ —É–∫–∞–∑–∞–Ω–æ' ? fullname : '<span style="color: var(--color-text-muted);">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
      document.getElementById('profile-phone').innerHTML = data.phone || '<span style="color: var(--color-text-muted);">–ù–µ —É–∫–∞–∑–∞–Ω</span>';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
      document.getElementById('profile-specialization').innerHTML = data.specialization || '<span style="color: var(--color-text-muted);">–ù–µ —É–∫–∞–∑–∞–Ω–∞</span>';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—ã—Ç
      const expEl = document.getElementById('profile-experience');
      expEl.innerHTML = data.experience || '<span style="color: var(--color-text-muted);">–ù–µ —É–∫–∞–∑–∞–Ω</span>';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—é–º–µ
      if (data.resume) {
        const resumeEl = document.getElementById('profile-resume');
        if (resumeEl) {
          resumeEl.innerHTML = data.resume;
        } else {
          // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ä–µ–∑—é–º–µ, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
          const profileInfo = document.getElementById('profile-info');
          const resumeField = document.createElement('div');
          resumeField.className = 'profile-field';
          resumeField.innerHTML = '<strong>–†–µ–∑—é–º–µ:</strong> <div id="profile-resume" style="margin-top: 4px; color: var(--color-text-primary); white-space: pre-wrap;">' + data.resume + '</div>';
          profileInfo.appendChild(resumeField);
        }
      }
    }
  </script>
{% endblock %}
