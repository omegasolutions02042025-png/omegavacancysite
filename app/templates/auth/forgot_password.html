{% extends "layouts/auth_layout.html" %}

{% block title %}Восстановление пароля — Omega Hire{% endblock %}

{% block content %}
<div class="mb-5">
    <h1 class="mb-2">Восстановление пароля</h1>
    <p class="text-muted">Введите ваш email, и мы отправим вам ссылку для восстановления пароля</p>
</div>

<div id="error-message" class="alert alert-danger d-none mb-4" role="alert"></div>
<div id="success-message" class="alert alert-success d-none mb-4" role="alert"></div>

<form id="reset_form">
    <div class="mb-4">
        <label class="form-label d-block mb-2 text-muted small fw-bold">EMAIL</label>
        <input 
            name="email" 
            type="email" 
            placeholder="name@company.com" 
            class="form-input" 
            required
            autocomplete="email"
        >
    </div>

    <button type="submit" class="btn btn-primary w-100 mb-4">
        Отправить ссылку
    </button>

    <div class="text-center">
        <a href="/auth/login" class="text-gold text-decoration-none">← Назад к входу</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
    const form = document.getElementById("reset_form");
    const errorMessage = document.getElementById("error-message");
    const successMessage = document.getElementById("success-message");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        errorMessage.classList.add("d-none");
        successMessage.classList.add("d-none");
        
        const formData = new FormData(form);
        const email = formData.get("email");

        try {
            const resp = await fetch("/auth/forgot-password", {
                method: "POST",
                body: formData
            });

            if (resp.status === 404) {
                let errorText = "Пользователь с таким email не найден или аккаунт не подтвержден";
                try {
                    const data = await resp.json();
                    errorText = data.detail || errorText;
                } catch {}
                errorMessage.textContent = errorText;
                errorMessage.classList.remove("d-none");
                return;
            }

            if (resp.ok) {
                successMessage.textContent = "Ссылка для восстановления пароля отправлена на ваш email!";
                successMessage.classList.remove("d-none");
                form.style.display = "none";
            } else {
                errorMessage.textContent = "Произошла ошибка. Попробуйте позже.";
                errorMessage.classList.remove("d-none");
            }
        } catch (error) {
            errorMessage.textContent = "Ошибка сети. Попробуйте позже.";
            errorMessage.classList.remove("d-none");
        }
    });
</script>
{% endblock %}
