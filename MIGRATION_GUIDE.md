# –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö - –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## –í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 1. –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `registration_requests`
–°–æ–∑–¥–∞–Ω–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞—è–≤–æ–∫ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï**: –ü–æ–ª–µ `hashed_password` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤ `password`
- –ü–∞—Ä–æ–ª–∏ —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º)

## –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ SQL (–µ—Å–ª–∏ –µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ)

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ password
ALTER TABLE users ADD COLUMN password VARCHAR;

-- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ hashed_password –≤ password (–≤—Ä–µ–º–µ–Ω–Ω–æ)
UPDATE users SET password = hashed_password;

-- –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ
ALTER TABLE users DROP COLUMN hashed_password;

-- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É registration_requests
CREATE TABLE registration_requests (
    id SERIAL PRIMARY KEY,
    email VARCHAR UNIQUE NOT NULL,
    password VARCHAR NOT NULL,
    verification_token VARCHAR NOT NULL,
    is_email_verified BOOLEAN DEFAULT FALSE,
    is_approved BOOLEAN,
    approved_by_admin INTEGER REFERENCES admins(id),
    created_at VARCHAR,
    verified_at VARCHAR,
    processed_at VARCHAR
);
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ)

```python
# –í main.py –∏–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ
from app.database.database import create_tables, engine
from sqlalchemy import text

async def recreate_database():
    # –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
    async with engine.begin() as conn:
        await conn.execute(text("DROP SCHEMA public CASCADE"))
        await conn.execute(text("CREATE SCHEMA public"))
    
    # –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∑–∞–Ω–æ–≤–æ
    await create_tables()

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
import asyncio
asyncio.run(recreate_database())
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å alembic (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å alembic –µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
pip install alembic

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å alembic
alembic init alembic

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Add registration system and change password storage"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade head
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü–∞—Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- –≠—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–≥ –∏—Ö –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å
- **–í–ê–ñ–ù–û**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∑–∞—â–∏—â–µ–Ω
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

### üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email
–í —Ñ–∞–π–ª–µ `.env` –¥–æ–±–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP:

```env
SMTP_HOST=mailbe07.hoster.by
SMTP_PORT=465
SMTP_USERNAME=zakaz@omega-solutions.ru
SMTP_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å_–∑–¥–µ—Å—å
SMTP_FROM_EMAIL=zakaz@omega-solutions.ru
SMTP_USE_TLS=true
SMTP_USE_STARTTLS=false
```

### üîÑ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–æ–ª—è–º–∏:
1. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é "–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å" –¥–ª—è —Å–±—Ä–æ—Å–∞
2. –ò–ª–∏ –≤—Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ —á–µ—Ä–µ–∑ SQL:
```sql
UPDATE users SET password = '–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å' WHERE email = 'user@example.com';
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```bash
curl -X POST http://localhost:8000/admin/setup-initial-admin
```

### 2. –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ http://localhost:8000/admin/login
- –õ–æ–≥–∏–Ω: admin
- –ü–∞—Ä–æ–ª—å: OmegaAdmin2025!

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ http://localhost:8000/auth/register
2. –í–≤–µ—Å—Ç–∏ email –∏ –ø–∞—Ä–æ–ª—å
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á—Ç—É –∏ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
4. –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏ –æ–¥–æ–±—Ä–∏—Ç—å –∑–∞—è–≤–∫—É –≤ —Ä–∞–∑–¥–µ–ª–µ "–ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é"
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –ø–∏—Å—å–º–æ —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
6. –í–æ–π—Ç–∏ –ø–æ–¥ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –Ω–∞ http://localhost:8000/auth/login

## –ù–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- `GET /auth/register` - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏
- `POST /auth/register` - –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- `GET /auth/verify-email?token=...` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
- `GET /admin/pending-registrations` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫
- `POST /admin/approve-registration/{id}` - –û–¥–æ–±—Ä–∏—Ç—å –∑–∞—è–≤–∫—É
- `POST /admin/reject-registration/{id}` - –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É
- `GET /admin/candidates` - –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- `GET /admin/sverkas` - –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–≤–µ—Ä–æ–∫

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ:

```sql
-- –í–µ—Ä–Ω—É—Ç—å hashed_password
ALTER TABLE users ADD COLUMN hashed_password VARCHAR;
UPDATE users SET hashed_password = password;
ALTER TABLE users DROP COLUMN password;

-- –£–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∑–∞—è–≤–æ–∫
DROP TABLE registration_requests;
```

–ò –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ —á–µ—Ä–µ–∑ git:
```bash
git revert HEAD
```

